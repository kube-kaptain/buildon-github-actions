# SPDX-License-Identifier: MIT
# Copyright (c) 2025-2026 Kaptain contributors (Fred Cooke)

name: Kubernetes App - Manifests Only
on:
  workflow_call:
    inputs:
      # Build output
      output-sub-path:
        description: 'Build output directory (relative)'
        required: false
        type: string
        default: 'target'

      # Docker image override (optional - if not provided, tokens remain for later substitution)
      docker-image-name-override:
        description: 'Docker image name (if provided, substitutes into manifests; if empty, token remains for later substitution)'
        required: false
        type: string
        default: ''
      docker-image-tag-override:
        description: 'Docker image tag (if provided, substitutes into manifests; if empty, token remains for later substitution)'
        required: false
        type: string
        default: ''

      # Docker registry logins
      docker-registry-logins:
        description: 'YAML config for Docker registry logins (registry URL as key)'
        required: false
        type: string
        default: ''
      # Docker target config (for docker repo provider)
      docker-target-registry:
        description: 'Target container registry'
        required: false
        type: string
        default: 'ghcr.io'
      docker-target-base-path:
        description: 'Path between registry and image name (auto-set for GHCR)'
        required: false
        type: string
        default: ''
      # Docker push targets
      docker-push-targets:
        description: 'JSON array of additional push targets [{registry, base-path?}]'
        required: false
        type: string
        default: ''

      # Manifests source
      manifests-sub-path:
        description: 'Directory containing Kubernetes manifests (relative)'
        required: false
        type: string
        default: 'src/kubernetes'
      # Manifests packaging
      manifests-repo-provider-type:
        description: 'Repo provider type for manifest storage (default: docker, currently the only supported provider)'
        required: false
        type: string
        default: 'docker'
      manifests-packaging-base-image:
        description: 'Base image for manifest packaging (default: scratch)'
        required: false
        type: string
        default: ''

      # Kubernetes generation
      kubernetes-global-additional-labels:
        description: 'Additional labels for all Kubernetes manifests (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-global-additional-annotations:
        description: 'Additional annotations for all Kubernetes manifests (comma-separated key=value)'
        required: false
        type: string
        default: ''
      # Kubernetes ConfigMap generation
      kubernetes-configmap-sub-path:
        description: 'Directory containing ConfigMap data files (relative)'
        required: false
        type: string
        default: 'src/configmap'
      kubernetes-configmap-name-checksum-injection:
        description: 'Enable checksum injection suffix in ConfigMap name (true: ProjectName-configmap-checksum, false: ProjectName)'
        required: false
        type: boolean
        default: true
      kubernetes-configmap-additional-labels:
        description: 'Additional labels specific to ConfigMap (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-configmap-additional-annotations:
        description: 'Additional annotations specific to ConfigMap (comma-separated key=value)'
        required: false
        type: string
        default: ''
      # Kubernetes Secret template generation
      kubernetes-secret-template-sub-path:
        description: 'Directory containing Secret template data files (relative)'
        required: false
        type: string
        default: 'src/secret.template'
      kubernetes-secret-template-name-checksum-injection:
        description: 'Enable checksum injection suffix in Secret name (true: ProjectName-secret-checksum, false: ProjectName)'
        required: false
        type: boolean
        default: true
      kubernetes-secret-template-additional-labels:
        description: 'Additional labels specific to Secret template (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-secret-template-additional-annotations:
        description: 'Additional annotations specific to Secret template (comma-separated key=value)'
        required: false
        type: string
        default: ''
      # Kubernetes ServiceAccount generation
      kubernetes-serviceaccount-generation-enabled:
        description: 'Enable ServiceAccount generation (true/false)'
        required: false
        type: boolean
        default: false
      kubernetes-serviceaccount-name-suffix:
        description: 'Optional suffix for ServiceAccount name and filename'
        required: false
        type: string
        default: ''
      kubernetes-serviceaccount-combined-sub-path:
        description: 'Sub-path within combined/ for output'
        required: false
        type: string
        default: ''
      kubernetes-serviceaccount-additional-labels:
        description: 'Additional labels specific to ServiceAccount (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-serviceaccount-additional-annotations:
        description: 'Additional annotations specific to ServiceAccount (comma-separated key=value)'
        required: false
        type: string
        default: ''
      # Kubernetes Workload generation
      kubernetes-workload-type:
        description: 'Workload type to generate (deployment, none)'
        required: false
        type: string
        default: 'deployment'
      kubernetes-workload-name-suffix:
        description: 'Optional suffix for workload name and filename'
        required: false
        type: string
        default: ''
      kubernetes-workload-combined-sub-path:
        description: 'Sub-path within combined/ for output'
        required: false
        type: string
        default: ''
      kubernetes-workload-env-sub-path:
        description: 'Directory containing environment variable files (default per workload type)'
        required: false
        type: string
        default: ''
      kubernetes-workload-additional-labels:
        description: 'Additional labels specific to workload (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-workload-additional-annotations:
        description: 'Additional annotations specific to workload (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-workload-container-port:
        description: 'Container port'
        required: false
        type: string
        default: '1024'
      kubernetes-workload-image-reference-style:
        description: 'Image reference style (combined, separate, project-name-prefixed-combined, project-name-prefixed-separate)'
        required: false
        type: string
        default: 'combined'
      kubernetes-workload-readonly-root-filesystem:
        description: 'Enable read-only root filesystem'
        required: false
        type: boolean
        default: true
      kubernetes-workload-seccomp-profile:
        description: 'Seccomp profile (DISABLED, RuntimeDefault, Localhost, Unconfined)'
        required: false
        type: string
        default: 'DISABLED'
      kubernetes-workload-automount-service-account-token:
        description: 'Automount service account token'
        required: false
        type: boolean
        default: false
      kubernetes-workload-image-pull-secrets:
        description: 'Include imagePullSecrets in pod spec (ENABLED/DISABLED)'
        required: false
        type: string
        default: 'ENABLED'
      # Resource configuration inputs
      kubernetes-workload-resources-memory:
        description: 'Memory limit (e.g., 128Mi, 1Gi)'
        required: false
        type: string
        default: '10Mi'
      kubernetes-workload-resources-cpu-request:
        description: 'CPU request (e.g., 100m, 1)'
        required: false
        type: string
        default: '100m'
      kubernetes-workload-resources-cpu-limit:
        description: 'CPU limit (empty for no limit)'
        required: false
        type: string
        default: ''
      kubernetes-workload-resources-ephemeral-storage:
        description: 'Ephemeral storage request/limit (e.g., 10Mi, 100Mi, 1Gi)'
        required: false
        type: string
        default: '10Mi'
      kubernetes-workload-configmap-mount-path:
        description: 'ConfigMap mount path in container'
        required: false
        type: string
        default: '/configmap'
      kubernetes-workload-secret-mount-path:
        description: 'Secret mount path in container'
        required: false
        type: string
        default: '/secret'
      kubernetes-workload-configmap-keys-for-env:
        description: 'Comma/space-separated ConfigMap keys to expose as env vars'
        required: false
        type: string
        default: ''
      kubernetes-workload-secret-keys-for-env:
        description: 'Comma/space-separated Secret keys to expose as env vars'
        required: false
        type: string
        default: ''
      kubernetes-workload-termination-grace-period-seconds:
        description: 'Termination grace period in seconds'
        required: false
        type: string
        default: '10'
      kubernetes-workload-prestop-command:
        description: 'PreStop hook command (empty for none)'
        required: false
        type: string
        default: ''
      kubernetes-workload-affinity-strategy:
        description: 'Pod affinity strategy plugin name'
        required: false
        type: string
        default: 'spread-nodes-and-zones-ha'
      # Liveness probe inputs
      kubernetes-workload-probe-liveness-check-type:
        description: 'Liveness probe type (http-get, tcp-socket, exec, grpc, none)'
        required: false
        type: string
        default: 'http-get'
      kubernetes-workload-probe-liveness-http-path:
        description: 'Liveness probe HTTP path'
        required: false
        type: string
        default: '/liveness'
      kubernetes-workload-probe-liveness-http-scheme:
        description: 'Liveness probe HTTP scheme (HTTP, HTTPS)'
        required: false
        type: string
        default: 'HTTP'
      kubernetes-workload-probe-liveness-tcp-port:
        description: 'Liveness probe TCP port (defaults to container port)'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-liveness-exec-command:
        description: 'Liveness probe exec command'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-liveness-grpc-port:
        description: 'Liveness probe gRPC port (defaults to container port)'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-liveness-grpc-service:
        description: 'Liveness probe gRPC service name'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-liveness-initial-delay-seconds:
        description: 'Liveness probe initial delay in seconds'
        required: false
        type: string
        default: '10'
      kubernetes-workload-probe-liveness-period-seconds:
        description: 'Liveness probe period in seconds'
        required: false
        type: string
        default: '10'
      kubernetes-workload-probe-liveness-timeout-seconds:
        description: 'Liveness probe timeout in seconds'
        required: false
        type: string
        default: '5'
      kubernetes-workload-probe-liveness-failure-threshold:
        description: 'Liveness probe failure threshold'
        required: false
        type: string
        default: '3'
      kubernetes-workload-probe-liveness-termination-grace-period-seconds:
        description: 'Liveness probe termination grace period (empty for default)'
        required: false
        type: string
        default: ''
      # Readiness probe inputs
      kubernetes-workload-probe-readiness-check-type:
        description: 'Readiness probe type (http-get, tcp-socket, exec, grpc, none)'
        required: false
        type: string
        default: 'http-get'
      kubernetes-workload-probe-readiness-http-path:
        description: 'Readiness probe HTTP path'
        required: false
        type: string
        default: '/readiness'
      kubernetes-workload-probe-readiness-http-scheme:
        description: 'Readiness probe HTTP scheme (HTTP, HTTPS)'
        required: false
        type: string
        default: 'HTTP'
      kubernetes-workload-probe-readiness-tcp-port:
        description: 'Readiness probe TCP port (defaults to container port)'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-readiness-exec-command:
        description: 'Readiness probe exec command'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-readiness-grpc-port:
        description: 'Readiness probe gRPC port (defaults to container port)'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-readiness-grpc-service:
        description: 'Readiness probe gRPC service name'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-readiness-initial-delay-seconds:
        description: 'Readiness probe initial delay in seconds'
        required: false
        type: string
        default: '5'
      kubernetes-workload-probe-readiness-period-seconds:
        description: 'Readiness probe period in seconds'
        required: false
        type: string
        default: '5'
      kubernetes-workload-probe-readiness-timeout-seconds:
        description: 'Readiness probe timeout in seconds'
        required: false
        type: string
        default: '3'
      kubernetes-workload-probe-readiness-failure-threshold:
        description: 'Readiness probe failure threshold'
        required: false
        type: string
        default: '3'
      kubernetes-workload-probe-readiness-success-threshold:
        description: 'Readiness probe success threshold'
        required: false
        type: string
        default: '1'
      # Startup probe inputs
      kubernetes-workload-probe-startup-check-type:
        description: 'Startup probe type (http-get, tcp-socket, exec, grpc, none)'
        required: false
        type: string
        default: 'http-get'
      kubernetes-workload-probe-startup-http-path:
        description: 'Startup probe HTTP path'
        required: false
        type: string
        default: '/startup'
      kubernetes-workload-probe-startup-http-scheme:
        description: 'Startup probe HTTP scheme (HTTP, HTTPS)'
        required: false
        type: string
        default: 'HTTP'
      kubernetes-workload-probe-startup-tcp-port:
        description: 'Startup probe TCP port (defaults to container port)'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-startup-exec-command:
        description: 'Startup probe exec command'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-startup-grpc-port:
        description: 'Startup probe gRPC port (defaults to container port)'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-startup-grpc-service:
        description: 'Startup probe gRPC service name'
        required: false
        type: string
        default: ''
      kubernetes-workload-probe-startup-initial-delay-seconds:
        description: 'Startup probe initial delay in seconds'
        required: false
        type: string
        default: '0'
      kubernetes-workload-probe-startup-period-seconds:
        description: 'Startup probe period in seconds'
        required: false
        type: string
        default: '5'
      kubernetes-workload-probe-startup-timeout-seconds:
        description: 'Startup probe timeout in seconds'
        required: false
        type: string
        default: '3'
      kubernetes-workload-probe-startup-failure-threshold:
        description: 'Startup probe failure threshold'
        required: false
        type: string
        default: '30'
      kubernetes-workload-probe-startup-termination-grace-period-seconds:
        description: 'Startup probe termination grace period (empty for default)'
        required: false
        type: string
        default: ''
      # Deployment-specific inputs for Kubernetes Deployment workloads
      kubernetes-deployment-replicas:
        description: 'Replica count (empty for token, NO for HPA management)'
        required: false
        type: string
        default: ''
      kubernetes-deployment-revision-history-limit:
        description: 'Number of old ReplicaSets to retain'
        required: false
        type: string
        default: '10'
      # Kubernetes Service generation
      kubernetes-service-generation-enabled:
        description: 'Enable Service generation (default: auto based on workload type)'
        required: false
        type: boolean
      kubernetes-service-type:
        description: 'Service type (ClusterIP, NodePort, LoadBalancer)'
        required: false
        type: string
        default: 'ClusterIP'
      kubernetes-service-port:
        description: 'Service port'
        required: false
        type: string
        default: '80'
      kubernetes-service-target-port:
        description: 'Target port (defaults to container port)'
        required: false
        type: string
        default: ''
      kubernetes-service-protocol:
        description: 'Protocol (TCP, UDP, SCTP)'
        required: false
        type: string
        default: 'TCP'
      kubernetes-service-name-suffix:
        description: 'Optional suffix for Service name and filename'
        required: false
        type: string
        default: ''
      kubernetes-service-combined-sub-path:
        description: 'Sub-path within combined/ for output'
        required: false
        type: string
        default: ''
      kubernetes-service-additional-labels:
        description: 'Additional labels specific to Service (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-service-additional-annotations:
        description: 'Additional annotations specific to Service (comma-separated key=value)'
        required: false
        type: string
        default: ''

      # Token substitution
      token-delimiter-style:
        description: 'Token delimiter syntax for variables (shell, mustache, helm, erb, github-actions, blade, stringtemplate, ognl, t4, swift)'
        required: false
        type: string
        default: 'shell'
      token-name-style:
        description: 'Case style for token names (UPPER_SNAKE, lower_snake, lower-kebab, UPPER-KEBAB, camelCase, PascalCase, lower.dot, UPPER.DOT)'
        required: false
        type: string
        default: 'PascalCase'
      token-name-validation:
        description: 'How to validate user token names (MATCH = must match token-name-style, ALL = accept any valid name)'
        required: false
        type: string
        default: 'MATCH'
      allow-builtin-token-override:
        description: 'Allow user tokens to override built-in tokens (for template/reusable projects)'
        required: false
        type: boolean
        default: false
      config-sub-path:
        description: 'Directory containing user-defined token files (relative)'
        required: false
        type: string
        default: 'src/config'
      config-value-trailing-newline:
        description: 'How to handle trailing newlines in config values (strip-for-single-line, preserve-all, always-strip-one-newline)'
        required: false
        type: string
        default: 'strip-for-single-line'

      # Naming, Versions, and Tags calculation
      release-branch:
        description: 'The release branch name'
        required: false
        type: string
        default: 'main'
      additional-release-branches:
        description: 'Comma-separated list of additional release branches'
        required: false
        type: string
        default: ''
      tag-version-max-parts:
        description: 'Maximum allowed version parts (fail if exceeded)'
        required: false
        type: number
        default: 3
      tag-version-calculation-strategy:
        description: 'Strategy for calculating version (git-auto-closest-highest, file-pattern-match)'
        required: false
        type: string
        default: 'git-auto-closest-highest'
      tag-version-pattern-type:
        description: 'Pattern type for file-pattern-match strategy (dockerfile-env-kubectl, retag-workflow-source-tag, custom)'
        required: false
        type: string
        default: 'dockerfile-env-kubectl'
      tag-version-prefix-parts:
        description: 'Number of parts from source version to use as prefix (default 2, output = prefix + 1 parts)'
        required: false
        type: string
        default: ''
      dockerfile-sub-path:
        description: 'Directory containing Dockerfile, relative to repo root.'
        required: false
        type: string
        default: 'src/docker'
      dockerfile-squash:
        description: 'Enable --squash (requires experimental mode)'
        required: false
        type: boolean
        default: true
      dockerfile-no-cache:
        description: 'Disable layer caching for reproducible builds'
        required: false
        type: boolean
        default: true
      tag-version-source-sub-path:
        description: 'Override path to source directory (takes precedence over dockerfile-sub-path)'
        required: false
        type: string
        default: ''
      tag-version-source-file-name:
        description: 'Override source file name (defaults based on pattern type)'
        required: false
        type: string
        default: ''
      tag-version-source-custom-pattern:
        description: 'Regex with capture group for version extraction (required for custom pattern type)'
        required: false
        type: string
        default: ''

      # Quality check options
      block-slashes:
        description: 'DEPRECATED: Use block-slash-containing-branches instead'
        required: false
        type: boolean
        default: false
      qc-block-slash-containing-branches:
        description: 'Block branch names containing slashes'
        required: false
        type: boolean
        default: false
      qc-block-double-hyphen-containing-branches:
        description: 'Block branch names containing double hyphens (typo detection)'
        required: false
        type: boolean
        default: true
      qc-require-conventional-branches:
        description: 'Require branch names start with feature/, fix/, etc.'
        required: false
        type: boolean
        default: false
      qc-require-conventional-commits:
        description: 'Require commits use conventional commit format (feat:, fix:, etc.)'
        required: false
        type: boolean
        default: false
      qc-block-conventional-commits:
        description: 'Block commits that use conventional commit format'
        required: false
        type: boolean
        default: false

      # Hook script paths
      hook-pre-tagging-tests-script-sub-path:
        description: 'Path to pre-tagging test script relative to .github/ (e.g., bin/pre-tagging.bash)'
        required: false
        type: string
        default: ''
      hook-pre-package-prepare-script-sub-path:
        description: 'Path to pre-package prepare script relative to .github/ (e.g., bin/pre-package-prepare.bash)'
        required: false
        type: string
        default: ''
      hook-post-package-tests-script-sub-path:
        description: 'Path to post-package test script relative to .github/ (e.g., bin/post-package.bash)'
        required: false
        type: string
        default: ''

      # GitHub release
      github-release-enabled:
        description: 'Create a GitHub release on version tags'
        required: false
        type: boolean
        default: true
      github-release-substituted-files:
        description: 'Files with token substitution and version suffix (space-separated)'
        required: false
        type: string
        default: ''
      github-release-verbatim-files:
        description: 'Files copied as-is with version suffix only (space-separated)'
        required: false
        type: string
        default: ''
      github-release-notes:
        description: 'Release notes (leave empty for auto-generated)'
        required: false
        type: string
        default: ''
      github-release-add-version-to-filenames:
        description: 'Add version suffix to release filenames (e.g., file.yaml -> file-1.2.3.yaml)'
        required: false
        type: boolean
        default: true
    secrets:
      docker-registry-logins-secrets:
        description: 'JSON object of secrets for docker-registry-logins (e.g., {"DOCKER_USER": "x", "DOCKER_PASS": "y"})'
        required: false
    outputs:
      # Version outputs
      version:
        description: 'The generated version'
        value: ${{ jobs.build.outputs.version }}
      version-major:
        description: 'Major version number'
        value: ${{ jobs.build.outputs.version-major }}
      version-minor:
        description: 'Minor version number'
        value: ${{ jobs.build.outputs.version-minor }}
      version-patch:
        description: 'Patch version number'
        value: ${{ jobs.build.outputs.version-patch }}
      version-2-part:
        description: 'Version padded/truncated to 2 parts'
        value: ${{ jobs.build.outputs.version-2-part }}
      version-3-part:
        description: 'Version padded/truncated to 3 parts'
        value: ${{ jobs.build.outputs.version-3-part }}
      version-4-part:
        description: 'Version padded/truncated to 4 parts'
        value: ${{ jobs.build.outputs.version-4-part }}
      docker-tag:
        description: 'Tag for Docker images'
        value: ${{ jobs.build.outputs.docker-tag }}
      docker-image-name:
        description: 'Docker image name'
        value: ${{ jobs.build.outputs.docker-image-name }}
      git-tag:
        description: 'Tag for git'
        value: ${{ jobs.build.outputs.git-tag }}
      project-name:
        description: 'The repository/project name'
        value: ${{ jobs.build.outputs.project-name }}
      is-release:
        description: 'Whether this is a release build'
        value: ${{ jobs.build.outputs.is-release }}
      # Package outputs
      manifests-zip-sub-path:
        description: 'Directory containing manifests zip file (relative)'
        value: ${{ jobs.build.outputs.manifests-zip-sub-path }}
      manifests-zip-file-name:
        description: 'Name of manifests zip file'
        value: ${{ jobs.build.outputs.manifests-zip-file-name }}
      # Manifest repo provider publish outputs
      manifests-uri:
        description: 'Reference to published manifests (format depends on repo provider)'
        value: ${{ jobs.build.outputs.manifests-uri }}
      manifests-published:
        description: 'Whether manifests were published'
        value: ${{ jobs.build.outputs.manifests-published }}
jobs:
  basic-quality-checks:
    name: Basic Quality Checks
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-24.04
    permissions:
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@v4.2.2
        with:
          fetch-depth: 0
          fetch-tags: true
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Parse workflow ref
        id: parse
        run: |
          # Extract caller's workflow file path from github.workflow_ref
          # Format: owner/repo/.github/workflows/file.yaml@ref
          workflow_path="${GITHUB_WORKFLOW_REF%%@*}"
          workflow_file=".github/workflows/${workflow_path##*/}"

          echo "Resolving ref for reusable workflow: kubernetes-app-manifests-only.yaml"
          echo "Caller workflow: $workflow_file"

          # Check for local call (dogfooding) - uses: ./.github/workflows/...
          if grep -q 'uses:[[:space:]]*\./.github/workflows/kubernetes-app-manifests-only\.yaml[[:space:]]*$' "$workflow_file" || \
             grep -q 'uses:[[:space:]]*\./.github/workflows/kubernetes-app-manifests-only\.yaml[[:space:]]*#' "$workflow_file"; then
            echo "Local workflow call detected (dogfooding)"
            echo "ref=LOCAL" >> "$GITHUB_OUTPUT"
            exit 0
          fi

          # Find all uses lines that call this workflow and extract refs
          refs=$(grep -o 'buildon-github-actions/.github/workflows/kubernetes-app-manifests-only\.yaml@[^[:space:]"'"'"']*' "$workflow_file" | sed 's/.*@//')

          if [ -z "$refs" ]; then
            echo "::error::Could not find buildon-github-actions ref in $workflow_file"
            exit 1
          fi

          # Check all refs are identical
          unique_refs=$(echo "$refs" | sort -u)
          ref_count=$(echo "$unique_refs" | wc -l | tr -d ' ')
          echo "Found $ref_count unique ref(s): $(echo "$unique_refs" | tr '\n' ' ')"

          if [ "$ref_count" -gt 1 ]; then
            echo "::error::Multiple different refs found in $workflow_file: $(echo "$unique_refs" | tr '\n' ' ')"
            exit 1
          fi

          echo "Resolved ref: $unique_refs"
          echo "ref=$unique_refs" >> "$GITHUB_OUTPUT"
        env:
          GITHUB_WORKFLOW_REF: ${{ github.workflow_ref }}

      - name: Checkout actions
        if: steps.parse.outputs.ref != 'LOCAL' && success()
        uses: actions/checkout@v4.2.2
        with:
          repository: kube-kaptain/buildon-github-actions
          ref: ${{ steps.parse.outputs.ref }}
          path: .github/buildon-github-actions

      - name: Link local actions
        if: steps.parse.outputs.ref == 'LOCAL' && success()
        run: |
          echo "Linking local actions for dogfooding"
          ln -s "$(pwd)" .github/buildon-github-actions
      - name: Basic quality checks
        id: quality
        uses: ./.github/buildon-github-actions/src/actions/basic-quality-checks
        with:
          release-branch: ${{ inputs.release-branch }}
          additional-release-branches: ${{ inputs.additional-release-branches }}
          block-slashes: ${{ inputs.block-slashes }}
          qc-block-slash-containing-branches: ${{ inputs.qc-block-slash-containing-branches }}
          qc-block-double-hyphen-containing-branches: ${{ inputs.qc-block-double-hyphen-containing-branches }}
          qc-require-conventional-branches: ${{ inputs.qc-require-conventional-branches }}
          qc-require-conventional-commits: ${{ inputs.qc-require-conventional-commits }}
          qc-block-conventional-commits: ${{ inputs.qc-block-conventional-commits }}
  build:
    name: Build & Publish
    needs: basic-quality-checks
    if: always() && (needs.basic-quality-checks.result == 'success' || needs.basic-quality-checks.result == 'skipped')
    runs-on: ubuntu-24.04
    permissions:
      contents: write
      packages: write
      checks: write
    outputs:
      version: ${{ steps.versions.outputs.version }}
      version-major: ${{ steps.versions.outputs.version-major }}
      version-minor: ${{ steps.versions.outputs.version-minor }}
      version-patch: ${{ steps.versions.outputs.version-patch }}
      version-2-part: ${{ steps.versions.outputs.version-2-part }}
      version-3-part: ${{ steps.versions.outputs.version-3-part }}
      version-4-part: ${{ steps.versions.outputs.version-4-part }}
      docker-tag: ${{ steps.versions.outputs.docker-tag }}
      docker-image-name: ${{ steps.versions.outputs.docker-image-name }}
      git-tag: ${{ steps.versions.outputs.git-tag }}
      project-name: ${{ steps.versions.outputs.project-name }}
      is-release: ${{ steps.versions.outputs.is-release }}
      manifests-zip-sub-path: ${{ steps.manifest-package.outputs.manifests-zip-sub-path }}
      manifests-zip-file-name: ${{ steps.manifest-package.outputs.manifests-zip-file-name }}
      manifests-uri: ${{ steps.manifest-repo-provider-publish.outputs.manifests-uri }}
      manifests-published: ${{ steps.manifest-repo-provider-publish.outputs.manifests-published }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4.2.2
        with:
          fetch-depth: 0
          fetch-tags: true
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Parse workflow ref
        id: parse
        run: |
          # Extract caller's workflow file path from github.workflow_ref
          # Format: owner/repo/.github/workflows/file.yaml@ref
          workflow_path="${GITHUB_WORKFLOW_REF%%@*}"
          workflow_file=".github/workflows/${workflow_path##*/}"

          echo "Resolving ref for reusable workflow: kubernetes-app-manifests-only.yaml"
          echo "Caller workflow: $workflow_file"

          # Check for local call (dogfooding) - uses: ./.github/workflows/...
          if grep -q 'uses:[[:space:]]*\./.github/workflows/kubernetes-app-manifests-only\.yaml[[:space:]]*$' "$workflow_file" || \
             grep -q 'uses:[[:space:]]*\./.github/workflows/kubernetes-app-manifests-only\.yaml[[:space:]]*#' "$workflow_file"; then
            echo "Local workflow call detected (dogfooding)"
            echo "ref=LOCAL" >> "$GITHUB_OUTPUT"
            exit 0
          fi

          # Find all uses lines that call this workflow and extract refs
          refs=$(grep -o 'buildon-github-actions/.github/workflows/kubernetes-app-manifests-only\.yaml@[^[:space:]"'"'"']*' "$workflow_file" | sed 's/.*@//')

          if [ -z "$refs" ]; then
            echo "::error::Could not find buildon-github-actions ref in $workflow_file"
            exit 1
          fi

          # Check all refs are identical
          unique_refs=$(echo "$refs" | sort -u)
          ref_count=$(echo "$unique_refs" | wc -l | tr -d ' ')
          echo "Found $ref_count unique ref(s): $(echo "$unique_refs" | tr '\n' ' ')"

          if [ "$ref_count" -gt 1 ]; then
            echo "::error::Multiple different refs found in $workflow_file: $(echo "$unique_refs" | tr '\n' ' ')"
            exit 1
          fi

          echo "Resolved ref: $unique_refs"
          echo "ref=$unique_refs" >> "$GITHUB_OUTPUT"
        env:
          GITHUB_WORKFLOW_REF: ${{ github.workflow_ref }}

      - name: Checkout actions
        if: steps.parse.outputs.ref != 'LOCAL' && success()
        uses: actions/checkout@v4.2.2
        with:
          repository: kube-kaptain/buildon-github-actions
          ref: ${{ steps.parse.outputs.ref }}
          path: .github/buildon-github-actions

      - name: Link local actions
        if: steps.parse.outputs.ref == 'LOCAL' && success()
        run: |
          echo "Linking local actions for dogfooding"
          ln -s "$(pwd)" .github/buildon-github-actions

      # === Pre-tagging Tests ===
      - name: Start check - Pre-tagging Tests
        if: inputs.hook-pre-tagging-tests-script-sub-path != '' && success()
        id: check-pre-tagging
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Pre-tagging Tests'
      - name: Run pre-tagging tests
        if: inputs.hook-pre-tagging-tests-script-sub-path != '' && success()
        id: pre-tagging-tests
        uses: ./.github/buildon-github-actions/src/actions/hook-pre-tagging-tests
        with:
          script-sub-path: ${{ inputs.hook-pre-tagging-tests-script-sub-path }}
          # === Workflow Inputs ===
          # Build output
          output-sub-path: ${{ inputs.output-sub-path }}

          # Docker registry logins
          docker-registry-logins: ${{ inputs.docker-registry-logins }}
          # Docker build options
          dockerfile-sub-path: ${{ inputs.dockerfile-sub-path }}
          dockerfile-squash: ${{ inputs.dockerfile-squash }}
          dockerfile-no-cache: ${{ inputs.dockerfile-no-cache }}
          # Docker target config
          docker-target-registry: ${{ inputs.docker-target-registry }}
          docker-target-base-path: ${{ inputs.docker-target-base-path }}
          # Docker push targets
          docker-push-targets: ${{ inputs.docker-push-targets }}

          # Manifests source
          manifests-sub-path: ${{ inputs.manifests-sub-path }}
          # Manifests packaging
          manifests-repo-provider-type: ${{ inputs.manifests-repo-provider-type }}
          manifests-packaging-base-image: ${{ inputs.manifests-packaging-base-image }}

          # Kubernetes Generation
          kubernetes-global-additional-labels: ${{ inputs.kubernetes-global-additional-labels }}
          kubernetes-global-additional-annotations: ${{ inputs.kubernetes-global-additional-annotations }}
          # Kubernetes ConfigMap Generation
          kubernetes-configmap-sub-path: ${{ inputs.kubernetes-configmap-sub-path }}
          kubernetes-configmap-name-checksum-injection: ${{ inputs.kubernetes-configmap-name-checksum-injection }}
          kubernetes-configmap-additional-labels: ${{ inputs.kubernetes-configmap-additional-labels }}
          kubernetes-configmap-additional-annotations: ${{ inputs.kubernetes-configmap-additional-annotations }}
          # Kubernetes Secret template generation
          kubernetes-secret-template-sub-path: ${{ inputs.kubernetes-secret-template-sub-path }}
          kubernetes-secret-template-name-checksum-injection: ${{ inputs.kubernetes-secret-template-name-checksum-injection }}
          kubernetes-secret-template-additional-labels: ${{ inputs.kubernetes-secret-template-additional-labels }}
          kubernetes-secret-template-additional-annotations: ${{ inputs.kubernetes-secret-template-additional-annotations }}
          # Kubernetes ServiceAccount generation
          kubernetes-serviceaccount-generation-enabled: ${{ inputs.kubernetes-serviceaccount-generation-enabled }}
          kubernetes-serviceaccount-name-suffix: ${{ inputs.kubernetes-serviceaccount-name-suffix }}
          kubernetes-serviceaccount-combined-sub-path: ${{ inputs.kubernetes-serviceaccount-combined-sub-path }}
          kubernetes-serviceaccount-additional-labels: ${{ inputs.kubernetes-serviceaccount-additional-labels }}
          kubernetes-serviceaccount-additional-annotations: ${{ inputs.kubernetes-serviceaccount-additional-annotations }}
          # Kubernetes Workload generation
          kubernetes-workload-type: ${{ inputs.kubernetes-workload-type }}
          kubernetes-workload-name-suffix: ${{ inputs.kubernetes-workload-name-suffix }}
          kubernetes-workload-combined-sub-path: ${{ inputs.kubernetes-workload-combined-sub-path }}
          kubernetes-workload-env-sub-path: ${{ inputs.kubernetes-workload-env-sub-path }}
          kubernetes-workload-additional-labels: ${{ inputs.kubernetes-workload-additional-labels }}
          kubernetes-workload-additional-annotations: ${{ inputs.kubernetes-workload-additional-annotations }}
          kubernetes-workload-container-port: ${{ inputs.kubernetes-workload-container-port }}
          kubernetes-workload-image-reference-style: ${{ inputs.kubernetes-workload-image-reference-style }}
          kubernetes-workload-readonly-root-filesystem: ${{ inputs.kubernetes-workload-readonly-root-filesystem }}
          kubernetes-workload-seccomp-profile: ${{ inputs.kubernetes-workload-seccomp-profile }}
          kubernetes-workload-automount-service-account-token: ${{ inputs.kubernetes-workload-automount-service-account-token }}
          kubernetes-workload-image-pull-secrets: ${{ inputs.kubernetes-workload-image-pull-secrets }}
          kubernetes-workload-resources-memory: ${{ inputs.kubernetes-workload-resources-memory }}
          kubernetes-workload-resources-cpu-request: ${{ inputs.kubernetes-workload-resources-cpu-request }}
          kubernetes-workload-resources-cpu-limit: ${{ inputs.kubernetes-workload-resources-cpu-limit }}
          kubernetes-workload-configmap-mount-path: ${{ inputs.kubernetes-workload-configmap-mount-path }}
          kubernetes-workload-secret-mount-path: ${{ inputs.kubernetes-workload-secret-mount-path }}
          kubernetes-workload-termination-grace-period-seconds: ${{ inputs.kubernetes-workload-termination-grace-period-seconds }}
          kubernetes-workload-prestop-command: ${{ inputs.kubernetes-workload-prestop-command }}
          kubernetes-workload-affinity-strategy: ${{ inputs.kubernetes-workload-affinity-strategy }}
          kubernetes-workload-probe-liveness-check-type: ${{ inputs.kubernetes-workload-probe-liveness-check-type }}
          kubernetes-workload-probe-readiness-check-type: ${{ inputs.kubernetes-workload-probe-readiness-check-type }}
          kubernetes-workload-probe-startup-check-type: ${{ inputs.kubernetes-workload-probe-startup-check-type }}
          kubernetes-workload-probe-liveness-http-path: ${{ inputs.kubernetes-workload-probe-liveness-http-path }}
          kubernetes-workload-probe-readiness-http-path: ${{ inputs.kubernetes-workload-probe-readiness-http-path }}
          kubernetes-workload-probe-startup-http-path: ${{ inputs.kubernetes-workload-probe-startup-http-path }}
          kubernetes-deployment-replicas: ${{ inputs.kubernetes-deployment-replicas }}
          kubernetes-deployment-revision-history-limit: ${{ inputs.kubernetes-deployment-revision-history-limit }}
          # Kubernetes Service generation
          kubernetes-service-generation-enabled: ${{ inputs.kubernetes-service-generation-enabled }}
          kubernetes-service-type: ${{ inputs.kubernetes-service-type }}
          kubernetes-service-port: ${{ inputs.kubernetes-service-port }}
          kubernetes-service-target-port: ${{ inputs.kubernetes-service-target-port }}
          kubernetes-service-protocol: ${{ inputs.kubernetes-service-protocol }}
          kubernetes-service-name-suffix: ${{ inputs.kubernetes-service-name-suffix }}
          kubernetes-service-combined-sub-path: ${{ inputs.kubernetes-service-combined-sub-path }}
          kubernetes-service-additional-labels: ${{ inputs.kubernetes-service-additional-labels }}
          kubernetes-service-additional-annotations: ${{ inputs.kubernetes-service-additional-annotations }}

          # Token substitution
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          token-name-style: ${{ inputs.token-name-style }}
          token-name-validation: ${{ inputs.token-name-validation }}
          allow-builtin-token-override: ${{ inputs.allow-builtin-token-override }}
          config-sub-path: ${{ inputs.config-sub-path }}
          config-value-trailing-newline: ${{ inputs.config-value-trailing-newline }}

          # Naming, Versions, and Tags calculation
          release-branch: ${{ inputs.release-branch }}
          additional-release-branches: ${{ inputs.additional-release-branches }}
          tag-version-max-parts: ${{ inputs.tag-version-max-parts }}
          tag-version-calculation-strategy: ${{ inputs.tag-version-calculation-strategy }}
          tag-version-pattern-type: ${{ inputs.tag-version-pattern-type }}
          tag-version-prefix-parts: ${{ inputs.tag-version-prefix-parts }}
          tag-version-source-sub-path: ${{ inputs.tag-version-source-sub-path }}
          tag-version-source-file-name: ${{ inputs.tag-version-source-file-name }}
          tag-version-source-custom-pattern: ${{ inputs.tag-version-source-custom-pattern }}

          # Quality check options
          block-slashes: ${{ inputs.block-slashes }}
          qc-block-slash-containing-branches: ${{ inputs.qc-block-slash-containing-branches }}
          qc-block-double-hyphen-containing-branches: ${{ inputs.qc-block-double-hyphen-containing-branches }}
          qc-require-conventional-branches: ${{ inputs.qc-require-conventional-branches }}
          qc-require-conventional-commits: ${{ inputs.qc-require-conventional-commits }}
          qc-block-conventional-commits: ${{ inputs.qc-block-conventional-commits }}

          # Hook script paths
          hook-pre-tagging-tests-script-sub-path: ${{ inputs.hook-pre-tagging-tests-script-sub-path }}
          hook-pre-docker-prepare-script-sub-path: ${{ inputs.hook-pre-docker-prepare-script-sub-path }}
          hook-post-docker-tests-script-sub-path: ${{ inputs.hook-post-docker-tests-script-sub-path }}
          hook-pre-package-prepare-script-sub-path: ${{ inputs.hook-pre-package-prepare-script-sub-path }}
          hook-post-package-tests-script-sub-path: ${{ inputs.hook-post-package-tests-script-sub-path }}

          # GitHub release
          github-release-enabled: ${{ inputs.github-release-enabled }}
          github-release-substituted-files: ${{ inputs.github-release-substituted-files }}
          github-release-verbatim-files: ${{ inputs.github-release-verbatim-files }}
          github-release-notes: ${{ inputs.github-release-notes }}
          github-release-add-version-to-filenames: ${{ inputs.github-release-add-version-to-filenames }}
      - name: Pass check - Pre-tagging Tests
        if: inputs.hook-pre-tagging-tests-script-sub-path != '' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-pre-tagging.outputs.check-run-id }}
      - name: Fail check - Pre-tagging Tests
        if: inputs.hook-pre-tagging-tests-script-sub-path != '' && failure() && steps.check-pre-tagging.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-pre-tagging.outputs.check-run-id }}

      # === Versions & Naming ===
      - name: Start check - Versions & Naming
        id: check-versions
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Versions & Naming'
      - name: Generate versions and naming
        id: versions
        uses: ./.github/buildon-github-actions/src/actions/versions-and-naming
        with:
          release-branch: ${{ inputs.release-branch }}
          additional-release-branches: ${{ inputs.additional-release-branches }}
          tag-version-max-parts: ${{ inputs.tag-version-max-parts }}
          tag-version-calculation-strategy: ${{ inputs.tag-version-calculation-strategy }}
          tag-version-pattern-type: ${{ inputs.tag-version-pattern-type }}
          tag-version-prefix-parts: ${{ inputs.tag-version-prefix-parts }}
          dockerfile-sub-path: ${{ inputs.dockerfile-sub-path }}
          tag-version-source-sub-path: ${{ inputs.tag-version-source-sub-path }}
          tag-version-source-file-name: ${{ inputs.tag-version-source-file-name }}
          tag-version-source-custom-pattern: ${{ inputs.tag-version-source-custom-pattern }}
      - name: Pass check - Versions & Naming
        if: success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-versions.outputs.check-run-id }}
      - name: Fail check - Versions & Naming
        if: failure() && steps.check-versions.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-versions.outputs.check-run-id }}

      # === Generate ConfigMap ===
      - name: Start check - Generate ConfigMap
        if: inputs.kubernetes-configmap-sub-path != '' && success()
        id: check-generate-configmap
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Generate ConfigMap'
      - name: Generate ConfigMap manifest
        id: generate-configmap
        if: inputs.kubernetes-configmap-sub-path != '' && success()
        uses: ./.github/buildon-github-actions/src/actions/generate-kubernetes-configmap
        with:
          kubernetes-configmap-sub-path: ${{ inputs.kubernetes-configmap-sub-path }}
          output-sub-path: ${{ inputs.output-sub-path }}
          token-name-style: ${{ inputs.token-name-style }}
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          kubernetes-configmap-name-checksum-injection: ${{ inputs.kubernetes-configmap-name-checksum-injection }}
          kubernetes-global-additional-labels: ${{ inputs.kubernetes-global-additional-labels }}
          kubernetes-global-additional-annotations: ${{ inputs.kubernetes-global-additional-annotations }}
          kubernetes-configmap-additional-labels: ${{ inputs.kubernetes-configmap-additional-labels }}
          kubernetes-configmap-additional-annotations: ${{ inputs.kubernetes-configmap-additional-annotations }}
      - name: Pass check - Generate ConfigMap
        if: inputs.kubernetes-configmap-sub-path != '' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-generate-configmap.outputs.check-run-id }}
      - name: Fail check - Generate ConfigMap
        if: inputs.kubernetes-configmap-sub-path != '' && failure() && steps.check-generate-configmap.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-generate-configmap.outputs.check-run-id }}

      # === Generate Secret Template ===
      - name: Start check - Generate Secret Template
        if: inputs.kubernetes-secret-template-sub-path != '' && success()
        id: check-generate-secret-template
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Generate Secret Template'
      - name: Generate Secret template manifest
        id: generate-secret-template
        if: inputs.kubernetes-secret-template-sub-path != '' && success()
        uses: ./.github/buildon-github-actions/src/actions/generate-kubernetes-secret-template
        with:
          kubernetes-secret-template-sub-path: ${{ inputs.kubernetes-secret-template-sub-path }}
          output-sub-path: ${{ inputs.output-sub-path }}
          token-name-style: ${{ inputs.token-name-style }}
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          kubernetes-secret-template-name-checksum-injection: ${{ inputs.kubernetes-secret-template-name-checksum-injection }}
          kubernetes-global-additional-labels: ${{ inputs.kubernetes-global-additional-labels }}
          kubernetes-global-additional-annotations: ${{ inputs.kubernetes-global-additional-annotations }}
          kubernetes-secret-template-additional-labels: ${{ inputs.kubernetes-secret-template-additional-labels }}
          kubernetes-secret-template-additional-annotations: ${{ inputs.kubernetes-secret-template-additional-annotations }}
      - name: Pass check - Generate Secret Template
        if: inputs.kubernetes-secret-template-sub-path != '' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-generate-secret-template.outputs.check-run-id }}
      - name: Fail check - Generate Secret Template
        if: inputs.kubernetes-secret-template-sub-path != '' && failure() && steps.check-generate-secret-template.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-generate-secret-template.outputs.check-run-id }}

      # === Generate ServiceAccount ===
      - name: Start check - Generate ServiceAccount
        if: inputs.kubernetes-serviceaccount-generation-enabled == true && success()
        id: check-generate-serviceaccount
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Generate ServiceAccount'
      - name: Generate ServiceAccount manifest
        id: generate-serviceaccount
        if: inputs.kubernetes-serviceaccount-generation-enabled == true && success()
        uses: ./.github/buildon-github-actions/src/actions/generate-kubernetes-serviceaccount
        with:
          kubernetes-serviceaccount-generation-enabled: ${{ inputs.kubernetes-serviceaccount-generation-enabled }}
          kubernetes-serviceaccount-name-suffix: ${{ inputs.kubernetes-serviceaccount-name-suffix }}
          kubernetes-serviceaccount-combined-sub-path: ${{ inputs.kubernetes-serviceaccount-combined-sub-path }}
          output-sub-path: ${{ inputs.output-sub-path }}
          token-name-style: ${{ inputs.token-name-style }}
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          kubernetes-global-additional-labels: ${{ inputs.kubernetes-global-additional-labels }}
          kubernetes-global-additional-annotations: ${{ inputs.kubernetes-global-additional-annotations }}
          kubernetes-serviceaccount-additional-labels: ${{ inputs.kubernetes-serviceaccount-additional-labels }}
          kubernetes-serviceaccount-additional-annotations: ${{ inputs.kubernetes-serviceaccount-additional-annotations }}
      - name: Pass check - Generate ServiceAccount
        if: inputs.kubernetes-serviceaccount-generation-enabled == true && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-generate-serviceaccount.outputs.check-run-id }}
      - name: Fail check - Generate ServiceAccount
        if: inputs.kubernetes-serviceaccount-generation-enabled == true && failure() && steps.check-generate-serviceaccount.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-generate-serviceaccount.outputs.check-run-id }}

      # === Generate Workload ===
      - name: Start check - Generate Workload Manifest
        if: inputs.kubernetes-workload-type != 'none' && success()
        id: check-generate-workload
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Generate Workload Manifest'
      - name: Generate workload manifest
        id: generate-workload
        if: inputs.kubernetes-workload-type != 'none' && success()
        uses: ./.github/buildon-github-actions/src/actions/generate-kubernetes-workload
        with:
          # Required context
          project-name: ${{ steps.versions.outputs.project-name }}
          # Workload type
          kubernetes-workload-type: ${{ inputs.kubernetes-workload-type }}
          # Common workload settings
          kubernetes-workload-name-suffix: ${{ inputs.kubernetes-workload-name-suffix }}
          kubernetes-workload-combined-sub-path: ${{ inputs.kubernetes-workload-combined-sub-path }}
          kubernetes-workload-env-sub-path: ${{ inputs.kubernetes-workload-env-sub-path }}
          kubernetes-workload-additional-labels: ${{ inputs.kubernetes-workload-additional-labels }}
          kubernetes-workload-additional-annotations: ${{ inputs.kubernetes-workload-additional-annotations }}
          # Container configuration
          kubernetes-workload-container-port: ${{ inputs.kubernetes-workload-container-port }}
          kubernetes-workload-image-reference-style: ${{ inputs.kubernetes-workload-image-reference-style }}
          # Security settings
          kubernetes-workload-readonly-root-filesystem: ${{ inputs.kubernetes-workload-readonly-root-filesystem }}
          kubernetes-workload-seccomp-profile: ${{ inputs.kubernetes-workload-seccomp-profile }}
          kubernetes-workload-automount-service-account-token: ${{ inputs.kubernetes-workload-automount-service-account-token }}
          kubernetes-workload-image-pull-secrets: ${{ inputs.kubernetes-workload-image-pull-secrets }}
          # Resource limits
          kubernetes-workload-resources-memory: ${{ inputs.kubernetes-workload-resources-memory }}
          kubernetes-workload-resources-cpu-request: ${{ inputs.kubernetes-workload-resources-cpu-request }}
          kubernetes-workload-resources-cpu-limit: ${{ inputs.kubernetes-workload-resources-cpu-limit }}
          kubernetes-workload-resources-ephemeral-storage: ${{ inputs.kubernetes-workload-resources-ephemeral-storage }}
          # Mount paths
          kubernetes-workload-configmap-mount-path: ${{ inputs.kubernetes-workload-configmap-mount-path }}
          kubernetes-workload-secret-mount-path: ${{ inputs.kubernetes-workload-secret-mount-path }}
          # Environment variable refs from ConfigMap/Secret keys
          kubernetes-workload-configmap-keys-for-env: ${{ inputs.kubernetes-workload-configmap-keys-for-env }}
          kubernetes-workload-secret-keys-for-env: ${{ inputs.kubernetes-workload-secret-keys-for-env }}
          # Lifecycle
          kubernetes-workload-termination-grace-period-seconds: ${{ inputs.kubernetes-workload-termination-grace-period-seconds }}
          kubernetes-workload-prestop-command: ${{ inputs.kubernetes-workload-prestop-command }}
          kubernetes-workload-affinity-strategy: ${{ inputs.kubernetes-workload-affinity-strategy }}
          # Probe check types
          kubernetes-workload-probe-liveness-check-type: ${{ inputs.kubernetes-workload-probe-liveness-check-type }}
          kubernetes-workload-probe-readiness-check-type: ${{ inputs.kubernetes-workload-probe-readiness-check-type }}
          kubernetes-workload-probe-startup-check-type: ${{ inputs.kubernetes-workload-probe-startup-check-type }}
          # Probe HTTP paths
          kubernetes-workload-probe-liveness-http-path: ${{ inputs.kubernetes-workload-probe-liveness-http-path }}
          kubernetes-workload-probe-readiness-http-path: ${{ inputs.kubernetes-workload-probe-readiness-http-path }}
          kubernetes-workload-probe-startup-http-path: ${{ inputs.kubernetes-workload-probe-startup-http-path }}
          # Deployment-specific settings
          kubernetes-deployment-replicas: ${{ inputs.kubernetes-deployment-replicas }}
          kubernetes-deployment-revision-history-limit: ${{ inputs.kubernetes-deployment-revision-history-limit }}
          # Global settings
          output-sub-path: ${{ inputs.output-sub-path }}
          token-name-style: ${{ inputs.token-name-style }}
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          kubernetes-global-additional-labels: ${{ inputs.kubernetes-global-additional-labels }}
          kubernetes-global-additional-annotations: ${{ inputs.kubernetes-global-additional-annotations }}
      - name: Pass check - Generate Workload Manifest
        if: inputs.kubernetes-workload-type != 'none' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-generate-workload.outputs.check-run-id }}
      - name: Fail check - Generate Workload Manifest
        if: inputs.kubernetes-workload-type != 'none' && failure() && steps.check-generate-workload.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-generate-workload.outputs.check-run-id }}

      # === Generate Service ===
      - name: Start check - Generate Service
        if: inputs.kubernetes-service-generation-enabled != false && (inputs.kubernetes-service-generation-enabled == true || inputs.kubernetes-workload-type == 'deployment') && success()
        id: check-generate-service
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Generate Service'
      - name: Generate Service manifest
        id: generate-service
        if: inputs.kubernetes-service-generation-enabled != false && (inputs.kubernetes-service-generation-enabled == true || inputs.kubernetes-workload-type == 'deployment') && success()
        uses: ./.github/buildon-github-actions/src/actions/generate-kubernetes-service
        with:
          # Service settings
          kubernetes-service-generation-enabled: ${{ inputs.kubernetes-service-generation-enabled }}
          kubernetes-service-type: ${{ inputs.kubernetes-service-type }}
          kubernetes-service-port: ${{ inputs.kubernetes-service-port }}
          kubernetes-service-target-port: ${{ inputs.kubernetes-service-target-port }}
          kubernetes-service-protocol: ${{ inputs.kubernetes-service-protocol }}
          kubernetes-service-name-suffix: ${{ inputs.kubernetes-service-name-suffix }}
          kubernetes-service-combined-sub-path: ${{ inputs.kubernetes-service-combined-sub-path }}
          kubernetes-service-additional-labels: ${{ inputs.kubernetes-service-additional-labels }}
          kubernetes-service-additional-annotations: ${{ inputs.kubernetes-service-additional-annotations }}
          # Workload settings (for defaults)
          kubernetes-workload-container-port: ${{ inputs.kubernetes-workload-container-port }}
          # Global settings
          output-sub-path: ${{ inputs.output-sub-path }}
          token-name-style: ${{ inputs.token-name-style }}
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          kubernetes-global-additional-labels: ${{ inputs.kubernetes-global-additional-labels }}
          kubernetes-global-additional-annotations: ${{ inputs.kubernetes-global-additional-annotations }}
      - name: Pass check - Generate Service
        if: inputs.kubernetes-service-generation-enabled != false && (inputs.kubernetes-service-generation-enabled == true || inputs.kubernetes-workload-type == 'deployment') && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-generate-service.outputs.check-run-id }}
      - name: Fail check - Generate Service
        if: inputs.kubernetes-service-generation-enabled != false && (inputs.kubernetes-service-generation-enabled == true || inputs.kubernetes-workload-type == 'deployment') && failure() && steps.check-generate-service.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-generate-service.outputs.check-run-id }}

      # === Pre-package Prepare ===
      - name: Start check - Pre-package Prepare
        if: inputs.hook-pre-package-prepare-script-sub-path != '' && success()
        id: check-pre-package-prepare
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Pre-package Prepare'
      - name: Run pre-package prepare
        if: inputs.hook-pre-package-prepare-script-sub-path != '' && success()
        id: pre-package-prepare
        uses: ./.github/buildon-github-actions/src/actions/hook-pre-package-prepare
        with:
          script-sub-path: ${{ inputs.hook-pre-package-prepare-script-sub-path }}
          # === Workflow Inputs ===
          # Build output
          output-sub-path: ${{ inputs.output-sub-path }}

          # Docker registry logins
          docker-registry-logins: ${{ inputs.docker-registry-logins }}
          # Docker build options
          dockerfile-sub-path: ${{ inputs.dockerfile-sub-path }}
          dockerfile-squash: ${{ inputs.dockerfile-squash }}
          dockerfile-no-cache: ${{ inputs.dockerfile-no-cache }}
          # Docker target config
          docker-target-registry: ${{ inputs.docker-target-registry }}
          docker-target-base-path: ${{ inputs.docker-target-base-path }}
          # Docker push targets
          docker-push-targets: ${{ inputs.docker-push-targets }}

          # Manifests source
          manifests-sub-path: ${{ inputs.manifests-sub-path }}
          # Manifests packaging
          manifests-repo-provider-type: ${{ inputs.manifests-repo-provider-type }}
          manifests-packaging-base-image: ${{ inputs.manifests-packaging-base-image }}

          # Kubernetes Generation
          kubernetes-global-additional-labels: ${{ inputs.kubernetes-global-additional-labels }}
          kubernetes-global-additional-annotations: ${{ inputs.kubernetes-global-additional-annotations }}
          # Kubernetes ConfigMap Generation
          kubernetes-configmap-sub-path: ${{ inputs.kubernetes-configmap-sub-path }}
          kubernetes-configmap-name-checksum-injection: ${{ inputs.kubernetes-configmap-name-checksum-injection }}
          kubernetes-configmap-additional-labels: ${{ inputs.kubernetes-configmap-additional-labels }}
          kubernetes-configmap-additional-annotations: ${{ inputs.kubernetes-configmap-additional-annotations }}
          # Kubernetes Secret template generation
          kubernetes-secret-template-sub-path: ${{ inputs.kubernetes-secret-template-sub-path }}
          kubernetes-secret-template-name-checksum-injection: ${{ inputs.kubernetes-secret-template-name-checksum-injection }}
          kubernetes-secret-template-additional-labels: ${{ inputs.kubernetes-secret-template-additional-labels }}
          kubernetes-secret-template-additional-annotations: ${{ inputs.kubernetes-secret-template-additional-annotations }}
          # Kubernetes ServiceAccount generation
          kubernetes-serviceaccount-generation-enabled: ${{ inputs.kubernetes-serviceaccount-generation-enabled }}
          kubernetes-serviceaccount-name-suffix: ${{ inputs.kubernetes-serviceaccount-name-suffix }}
          kubernetes-serviceaccount-combined-sub-path: ${{ inputs.kubernetes-serviceaccount-combined-sub-path }}
          kubernetes-serviceaccount-additional-labels: ${{ inputs.kubernetes-serviceaccount-additional-labels }}
          kubernetes-serviceaccount-additional-annotations: ${{ inputs.kubernetes-serviceaccount-additional-annotations }}
          # Kubernetes Workload generation
          kubernetes-workload-type: ${{ inputs.kubernetes-workload-type }}
          kubernetes-workload-name-suffix: ${{ inputs.kubernetes-workload-name-suffix }}
          kubernetes-workload-combined-sub-path: ${{ inputs.kubernetes-workload-combined-sub-path }}
          kubernetes-workload-env-sub-path: ${{ inputs.kubernetes-workload-env-sub-path }}
          kubernetes-workload-additional-labels: ${{ inputs.kubernetes-workload-additional-labels }}
          kubernetes-workload-additional-annotations: ${{ inputs.kubernetes-workload-additional-annotations }}
          kubernetes-workload-container-port: ${{ inputs.kubernetes-workload-container-port }}
          kubernetes-workload-image-reference-style: ${{ inputs.kubernetes-workload-image-reference-style }}
          kubernetes-workload-readonly-root-filesystem: ${{ inputs.kubernetes-workload-readonly-root-filesystem }}
          kubernetes-workload-seccomp-profile: ${{ inputs.kubernetes-workload-seccomp-profile }}
          kubernetes-workload-automount-service-account-token: ${{ inputs.kubernetes-workload-automount-service-account-token }}
          kubernetes-workload-image-pull-secrets: ${{ inputs.kubernetes-workload-image-pull-secrets }}
          kubernetes-workload-resources-memory: ${{ inputs.kubernetes-workload-resources-memory }}
          kubernetes-workload-resources-cpu-request: ${{ inputs.kubernetes-workload-resources-cpu-request }}
          kubernetes-workload-resources-cpu-limit: ${{ inputs.kubernetes-workload-resources-cpu-limit }}
          kubernetes-workload-configmap-mount-path: ${{ inputs.kubernetes-workload-configmap-mount-path }}
          kubernetes-workload-secret-mount-path: ${{ inputs.kubernetes-workload-secret-mount-path }}
          kubernetes-workload-termination-grace-period-seconds: ${{ inputs.kubernetes-workload-termination-grace-period-seconds }}
          kubernetes-workload-prestop-command: ${{ inputs.kubernetes-workload-prestop-command }}
          kubernetes-workload-affinity-strategy: ${{ inputs.kubernetes-workload-affinity-strategy }}
          kubernetes-workload-probe-liveness-check-type: ${{ inputs.kubernetes-workload-probe-liveness-check-type }}
          kubernetes-workload-probe-readiness-check-type: ${{ inputs.kubernetes-workload-probe-readiness-check-type }}
          kubernetes-workload-probe-startup-check-type: ${{ inputs.kubernetes-workload-probe-startup-check-type }}
          kubernetes-workload-probe-liveness-http-path: ${{ inputs.kubernetes-workload-probe-liveness-http-path }}
          kubernetes-workload-probe-readiness-http-path: ${{ inputs.kubernetes-workload-probe-readiness-http-path }}
          kubernetes-workload-probe-startup-http-path: ${{ inputs.kubernetes-workload-probe-startup-http-path }}
          kubernetes-deployment-replicas: ${{ inputs.kubernetes-deployment-replicas }}
          kubernetes-deployment-revision-history-limit: ${{ inputs.kubernetes-deployment-revision-history-limit }}
          # Kubernetes Service generation
          kubernetes-service-generation-enabled: ${{ inputs.kubernetes-service-generation-enabled }}
          kubernetes-service-type: ${{ inputs.kubernetes-service-type }}
          kubernetes-service-port: ${{ inputs.kubernetes-service-port }}
          kubernetes-service-target-port: ${{ inputs.kubernetes-service-target-port }}
          kubernetes-service-protocol: ${{ inputs.kubernetes-service-protocol }}
          kubernetes-service-name-suffix: ${{ inputs.kubernetes-service-name-suffix }}
          kubernetes-service-combined-sub-path: ${{ inputs.kubernetes-service-combined-sub-path }}
          kubernetes-service-additional-labels: ${{ inputs.kubernetes-service-additional-labels }}
          kubernetes-service-additional-annotations: ${{ inputs.kubernetes-service-additional-annotations }}

          # Token substitution
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          token-name-style: ${{ inputs.token-name-style }}
          token-name-validation: ${{ inputs.token-name-validation }}
          allow-builtin-token-override: ${{ inputs.allow-builtin-token-override }}
          config-sub-path: ${{ inputs.config-sub-path }}
          config-value-trailing-newline: ${{ inputs.config-value-trailing-newline }}

          # Naming, Versions, and Tags calculation
          release-branch: ${{ inputs.release-branch }}
          additional-release-branches: ${{ inputs.additional-release-branches }}
          tag-version-max-parts: ${{ inputs.tag-version-max-parts }}
          tag-version-calculation-strategy: ${{ inputs.tag-version-calculation-strategy }}
          tag-version-pattern-type: ${{ inputs.tag-version-pattern-type }}
          tag-version-prefix-parts: ${{ inputs.tag-version-prefix-parts }}
          tag-version-source-sub-path: ${{ inputs.tag-version-source-sub-path }}
          tag-version-source-file-name: ${{ inputs.tag-version-source-file-name }}
          tag-version-source-custom-pattern: ${{ inputs.tag-version-source-custom-pattern }}

          # Quality check options
          block-slashes: ${{ inputs.block-slashes }}
          qc-block-slash-containing-branches: ${{ inputs.qc-block-slash-containing-branches }}
          qc-block-double-hyphen-containing-branches: ${{ inputs.qc-block-double-hyphen-containing-branches }}
          qc-require-conventional-branches: ${{ inputs.qc-require-conventional-branches }}
          qc-require-conventional-commits: ${{ inputs.qc-require-conventional-commits }}
          qc-block-conventional-commits: ${{ inputs.qc-block-conventional-commits }}

          # Hook script paths
          hook-pre-tagging-tests-script-sub-path: ${{ inputs.hook-pre-tagging-tests-script-sub-path }}
          hook-pre-docker-prepare-script-sub-path: ${{ inputs.hook-pre-docker-prepare-script-sub-path }}
          hook-post-docker-tests-script-sub-path: ${{ inputs.hook-post-docker-tests-script-sub-path }}
          hook-pre-package-prepare-script-sub-path: ${{ inputs.hook-pre-package-prepare-script-sub-path }}
          hook-post-package-tests-script-sub-path: ${{ inputs.hook-post-package-tests-script-sub-path }}

          # GitHub release
          github-release-enabled: ${{ inputs.github-release-enabled }}
          github-release-substituted-files: ${{ inputs.github-release-substituted-files }}
          github-release-verbatim-files: ${{ inputs.github-release-verbatim-files }}
          github-release-notes: ${{ inputs.github-release-notes }}
          github-release-add-version-to-filenames: ${{ inputs.github-release-add-version-to-filenames }}

          # === Step Outputs ===
          # Version outputs (from versions-and-naming)
          version: ${{ steps.versions.outputs.version }}
          version-major: ${{ steps.versions.outputs.version-major }}
          version-minor: ${{ steps.versions.outputs.version-minor }}
          version-patch: ${{ steps.versions.outputs.version-patch }}
          version-2-part: ${{ steps.versions.outputs.version-2-part }}
          version-3-part: ${{ steps.versions.outputs.version-3-part }}
          version-4-part: ${{ steps.versions.outputs.version-4-part }}
          docker-tag: ${{ steps.versions.outputs.docker-tag }}
          docker-image-name: ${{ steps.versions.outputs.docker-image-name }}
          git-tag: ${{ steps.versions.outputs.git-tag }}
          project-name: ${{ steps.versions.outputs.project-name }}
          is-release: ${{ steps.versions.outputs.is-release }}
          # Docker outputs (from docker-build - empty in manifests-only workflows)
          docker-substituted-sub-path: ${{ steps.docker-build.outputs.docker-substituted-sub-path }}
          target-image-full-uri: ${{ steps.docker-build.outputs.docker-target-image-full-uri }}
          # Manifest outputs (computed path for this position)
          manifests-substituted-sub-path: ${{ inputs.output-sub-path }}/manifests/substituted/${{ steps.versions.outputs.project-name }}
      - name: Pass check - Pre-package Prepare
        if: inputs.hook-pre-package-prepare-script-sub-path != '' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-pre-package-prepare.outputs.check-run-id }}
      - name: Fail check - Pre-package Prepare
        if: inputs.hook-pre-package-prepare-script-sub-path != '' && failure() && steps.check-pre-package-prepare.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-pre-package-prepare.outputs.check-run-id }}

      # === Manifest Package ===
      # Compute target registry and base path for manifests-only workflows (no docker build step)
      # Uses same step id as docker-build so manifest-package can use consistent output reference
      - name: Resolve target registry and base path
        id: docker-build
        uses: ./.github/buildon-github-actions/src/actions/resolve-target-registry-and-base-path
        with:
          target-registry: ${{ inputs.docker-target-registry }}
          target-base-path: ${{ inputs.docker-target-base-path }}
      - name: Start check - Package Manifests
        id: check-manifest-package
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Package Manifests'
      - name: Prepare manifests for packaging
        id: manifest-package-prepare
        uses: ./.github/buildon-github-actions/src/actions/kubernetes-manifests-package-prepare
        with:
          manifests-sub-path: ${{ inputs.manifests-sub-path }}
          project-name: ${{ steps.versions.outputs.project-name }}
          version: ${{ steps.versions.outputs.version }}
          docker-tag: ${{ steps.versions.outputs.docker-tag }}
          docker-image-name: ${{ steps.versions.outputs.docker-image-name }}
          docker-image-full-uri: ${{ steps.docker-build.outputs.docker-target-image-full-uri }}
          docker-target-registry: ${{ steps.docker-build.outputs.docker-target-registry }}
          docker-target-base-path: ${{ steps.docker-build.outputs.docker-target-base-path }}
          is-release: ${{ steps.versions.outputs.is-release }}
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          token-name-style: ${{ inputs.token-name-style }}
          token-name-validation: ${{ inputs.token-name-validation }}
          allow-builtin-token-override: ${{ inputs.allow-builtin-token-override }}
          config-sub-path: ${{ inputs.config-sub-path }}
          config-value-trailing-newline: ${{ inputs.config-value-trailing-newline }}
          output-sub-path: ${{ inputs.output-sub-path }}
      - name: Override docker image tokens
        id: manifest-package-only-token-override
        uses: ./.github/buildon-github-actions/src/actions/kubernetes-manifests-package-only-token-override
        with:
          docker-image-name-override: ${{ inputs.docker-image-name-override }}
          docker-tag-override: ${{ inputs.docker-image-tag-override }}
          output-sub-path: ${{ inputs.output-sub-path }}
          token-name-style: ${{ inputs.token-name-style }}
      - name: Package manifests
        id: manifest-package
        uses: ./.github/buildon-github-actions/src/actions/kubernetes-manifests-package
        with:
          project-name: ${{ steps.versions.outputs.project-name }}
          version: ${{ steps.versions.outputs.version }}
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          config-value-trailing-newline: ${{ inputs.config-value-trailing-newline }}
          output-sub-path: ${{ inputs.output-sub-path }}
      - name: Pass check - Package Manifests
        if: success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-manifest-package.outputs.check-run-id }}
      - name: Fail check - Package Manifests
        if: failure() && steps.check-manifest-package.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-manifest-package.outputs.check-run-id }}

      # === Manifest Repo Provider Package ===
      - name: Start check - Package Manifests for Repo Provider
        id: check-manifest-repo-provider-package
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Package Manifests for Repo Provider'
      - name: Docker registry logins
        uses: ./.github/buildon-github-actions/src/actions/docker-registry-logins
        with:
          config: ${{ inputs.docker-registry-logins }}
          secrets-json: ${{ secrets.docker-registry-logins-secrets || toJSON(secrets) }}
          docker-target-registry: ${{ inputs.docker-target-registry }}
      - name: Package manifests for repo provider
        id: manifest-repo-provider-package
        uses: ./.github/buildon-github-actions/src/actions/kubernetes-manifests-repo-provider-package
        with:
          manifests-repo-provider-type: ${{ inputs.manifests-repo-provider-type }}
          manifests-packaging-base-image: ${{ inputs.manifests-packaging-base-image }}
          manifests-zip-sub-path: ${{ steps.manifest-package.outputs.manifests-zip-sub-path }}
          manifests-zip-file-name: ${{ steps.manifest-package.outputs.manifests-zip-file-name }}
          docker-target-registry: ${{ steps.docker-build.outputs.docker-target-registry }}
          docker-target-base-path: ${{ steps.docker-build.outputs.docker-target-base-path }}
          docker-image-name: ${{ steps.versions.outputs.docker-image-name }}
          docker-tag: ${{ steps.versions.outputs.docker-tag }}-manifests
          version: ${{ steps.versions.outputs.version }}
          output-sub-path: ${{ inputs.output-sub-path }}
      - name: Pass check - Package Manifests for Repo Provider
        if: success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-manifest-repo-provider-package.outputs.check-run-id }}
      - name: Fail check - Package Manifests for Repo Provider
        if: failure() && steps.check-manifest-repo-provider-package.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-manifest-repo-provider-package.outputs.check-run-id }}

      # === Manifest Multi-Tag ===
      - name: Start check - Manifest Multi-Tag
        if: inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker' && success()
        id: check-manifest-multi-tag
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Manifest Multi-Tag'
      - name: Tag manifest images for additional registries
        id: manifest-multi-tag
        if: inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker' && success()
        uses: ./.github/buildon-github-actions/src/actions/docker-multi-tag
        with:
          docker-image-full-uri: ${{ steps.manifest-repo-provider-package.outputs.manifests-uri }}
          docker-image-name: ${{ steps.versions.outputs.docker-image-name }}
          docker-tag: ${{ steps.versions.outputs.docker-tag }}-manifests
          docker-push-targets: ${{ inputs.docker-push-targets }}
      - name: Pass check - Manifest Multi-Tag
        if: inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-manifest-multi-tag.outputs.check-run-id }}
      - name: Fail check - Manifest Multi-Tag
        if: inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker' && failure() && steps.check-manifest-multi-tag.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-manifest-multi-tag.outputs.check-run-id }}

      # === Post-package Tests ===
      - name: Start check - Post-package Tests
        if: inputs.hook-post-package-tests-script-sub-path != '' && success()
        id: check-post-package
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Post-package Tests'
      - name: Run post-package tests
        if: inputs.hook-post-package-tests-script-sub-path != '' && success()
        id: post-package-tests
        uses: ./.github/buildon-github-actions/src/actions/hook-post-package-tests
        with:
          script-sub-path: ${{ inputs.hook-post-package-tests-script-sub-path }}
          # === Workflow Inputs ===
          # Build output
          output-sub-path: ${{ inputs.output-sub-path }}

          # Docker registry logins
          docker-registry-logins: ${{ inputs.docker-registry-logins }}
          # Docker build options
          dockerfile-sub-path: ${{ inputs.dockerfile-sub-path }}
          dockerfile-squash: ${{ inputs.dockerfile-squash }}
          dockerfile-no-cache: ${{ inputs.dockerfile-no-cache }}
          # Docker target config
          docker-target-registry: ${{ inputs.docker-target-registry }}
          docker-target-base-path: ${{ inputs.docker-target-base-path }}
          # Docker push targets
          docker-push-targets: ${{ inputs.docker-push-targets }}

          # Manifests source
          manifests-sub-path: ${{ inputs.manifests-sub-path }}
          # Manifests packaging
          manifests-repo-provider-type: ${{ inputs.manifests-repo-provider-type }}
          manifests-packaging-base-image: ${{ inputs.manifests-packaging-base-image }}

          # Kubernetes Generation
          kubernetes-global-additional-labels: ${{ inputs.kubernetes-global-additional-labels }}
          kubernetes-global-additional-annotations: ${{ inputs.kubernetes-global-additional-annotations }}
          # Kubernetes ConfigMap Generation
          kubernetes-configmap-sub-path: ${{ inputs.kubernetes-configmap-sub-path }}
          kubernetes-configmap-name-checksum-injection: ${{ inputs.kubernetes-configmap-name-checksum-injection }}
          kubernetes-configmap-additional-labels: ${{ inputs.kubernetes-configmap-additional-labels }}
          kubernetes-configmap-additional-annotations: ${{ inputs.kubernetes-configmap-additional-annotations }}
          # Kubernetes Secret template generation
          kubernetes-secret-template-sub-path: ${{ inputs.kubernetes-secret-template-sub-path }}
          kubernetes-secret-template-name-checksum-injection: ${{ inputs.kubernetes-secret-template-name-checksum-injection }}
          kubernetes-secret-template-additional-labels: ${{ inputs.kubernetes-secret-template-additional-labels }}
          kubernetes-secret-template-additional-annotations: ${{ inputs.kubernetes-secret-template-additional-annotations }}
          # Kubernetes ServiceAccount generation
          kubernetes-serviceaccount-generation-enabled: ${{ inputs.kubernetes-serviceaccount-generation-enabled }}
          kubernetes-serviceaccount-name-suffix: ${{ inputs.kubernetes-serviceaccount-name-suffix }}
          kubernetes-serviceaccount-combined-sub-path: ${{ inputs.kubernetes-serviceaccount-combined-sub-path }}
          kubernetes-serviceaccount-additional-labels: ${{ inputs.kubernetes-serviceaccount-additional-labels }}
          kubernetes-serviceaccount-additional-annotations: ${{ inputs.kubernetes-serviceaccount-additional-annotations }}
          # Kubernetes Workload generation
          kubernetes-workload-type: ${{ inputs.kubernetes-workload-type }}
          kubernetes-workload-name-suffix: ${{ inputs.kubernetes-workload-name-suffix }}
          kubernetes-workload-combined-sub-path: ${{ inputs.kubernetes-workload-combined-sub-path }}
          kubernetes-workload-env-sub-path: ${{ inputs.kubernetes-workload-env-sub-path }}
          kubernetes-workload-additional-labels: ${{ inputs.kubernetes-workload-additional-labels }}
          kubernetes-workload-additional-annotations: ${{ inputs.kubernetes-workload-additional-annotations }}
          kubernetes-workload-container-port: ${{ inputs.kubernetes-workload-container-port }}
          kubernetes-workload-image-reference-style: ${{ inputs.kubernetes-workload-image-reference-style }}
          kubernetes-workload-readonly-root-filesystem: ${{ inputs.kubernetes-workload-readonly-root-filesystem }}
          kubernetes-workload-seccomp-profile: ${{ inputs.kubernetes-workload-seccomp-profile }}
          kubernetes-workload-automount-service-account-token: ${{ inputs.kubernetes-workload-automount-service-account-token }}
          kubernetes-workload-image-pull-secrets: ${{ inputs.kubernetes-workload-image-pull-secrets }}
          kubernetes-workload-resources-memory: ${{ inputs.kubernetes-workload-resources-memory }}
          kubernetes-workload-resources-cpu-request: ${{ inputs.kubernetes-workload-resources-cpu-request }}
          kubernetes-workload-resources-cpu-limit: ${{ inputs.kubernetes-workload-resources-cpu-limit }}
          kubernetes-workload-configmap-mount-path: ${{ inputs.kubernetes-workload-configmap-mount-path }}
          kubernetes-workload-secret-mount-path: ${{ inputs.kubernetes-workload-secret-mount-path }}
          kubernetes-workload-termination-grace-period-seconds: ${{ inputs.kubernetes-workload-termination-grace-period-seconds }}
          kubernetes-workload-prestop-command: ${{ inputs.kubernetes-workload-prestop-command }}
          kubernetes-workload-affinity-strategy: ${{ inputs.kubernetes-workload-affinity-strategy }}
          kubernetes-workload-probe-liveness-check-type: ${{ inputs.kubernetes-workload-probe-liveness-check-type }}
          kubernetes-workload-probe-readiness-check-type: ${{ inputs.kubernetes-workload-probe-readiness-check-type }}
          kubernetes-workload-probe-startup-check-type: ${{ inputs.kubernetes-workload-probe-startup-check-type }}
          kubernetes-workload-probe-liveness-http-path: ${{ inputs.kubernetes-workload-probe-liveness-http-path }}
          kubernetes-workload-probe-readiness-http-path: ${{ inputs.kubernetes-workload-probe-readiness-http-path }}
          kubernetes-workload-probe-startup-http-path: ${{ inputs.kubernetes-workload-probe-startup-http-path }}
          kubernetes-deployment-replicas: ${{ inputs.kubernetes-deployment-replicas }}
          kubernetes-deployment-revision-history-limit: ${{ inputs.kubernetes-deployment-revision-history-limit }}
          # Kubernetes Service generation
          kubernetes-service-generation-enabled: ${{ inputs.kubernetes-service-generation-enabled }}
          kubernetes-service-type: ${{ inputs.kubernetes-service-type }}
          kubernetes-service-port: ${{ inputs.kubernetes-service-port }}
          kubernetes-service-target-port: ${{ inputs.kubernetes-service-target-port }}
          kubernetes-service-protocol: ${{ inputs.kubernetes-service-protocol }}
          kubernetes-service-name-suffix: ${{ inputs.kubernetes-service-name-suffix }}
          kubernetes-service-combined-sub-path: ${{ inputs.kubernetes-service-combined-sub-path }}
          kubernetes-service-additional-labels: ${{ inputs.kubernetes-service-additional-labels }}
          kubernetes-service-additional-annotations: ${{ inputs.kubernetes-service-additional-annotations }}

          # Token substitution
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          token-name-style: ${{ inputs.token-name-style }}
          token-name-validation: ${{ inputs.token-name-validation }}
          allow-builtin-token-override: ${{ inputs.allow-builtin-token-override }}
          config-sub-path: ${{ inputs.config-sub-path }}
          config-value-trailing-newline: ${{ inputs.config-value-trailing-newline }}

          # Naming, Versions, and Tags calculation
          release-branch: ${{ inputs.release-branch }}
          additional-release-branches: ${{ inputs.additional-release-branches }}
          tag-version-max-parts: ${{ inputs.tag-version-max-parts }}
          tag-version-calculation-strategy: ${{ inputs.tag-version-calculation-strategy }}
          tag-version-pattern-type: ${{ inputs.tag-version-pattern-type }}
          tag-version-prefix-parts: ${{ inputs.tag-version-prefix-parts }}
          tag-version-source-sub-path: ${{ inputs.tag-version-source-sub-path }}
          tag-version-source-file-name: ${{ inputs.tag-version-source-file-name }}
          tag-version-source-custom-pattern: ${{ inputs.tag-version-source-custom-pattern }}

          # Quality check options
          block-slashes: ${{ inputs.block-slashes }}
          qc-block-slash-containing-branches: ${{ inputs.qc-block-slash-containing-branches }}
          qc-block-double-hyphen-containing-branches: ${{ inputs.qc-block-double-hyphen-containing-branches }}
          qc-require-conventional-branches: ${{ inputs.qc-require-conventional-branches }}
          qc-require-conventional-commits: ${{ inputs.qc-require-conventional-commits }}
          qc-block-conventional-commits: ${{ inputs.qc-block-conventional-commits }}

          # Hook script paths
          hook-pre-tagging-tests-script-sub-path: ${{ inputs.hook-pre-tagging-tests-script-sub-path }}
          hook-pre-docker-prepare-script-sub-path: ${{ inputs.hook-pre-docker-prepare-script-sub-path }}
          hook-post-docker-tests-script-sub-path: ${{ inputs.hook-post-docker-tests-script-sub-path }}
          hook-pre-package-prepare-script-sub-path: ${{ inputs.hook-pre-package-prepare-script-sub-path }}
          hook-post-package-tests-script-sub-path: ${{ inputs.hook-post-package-tests-script-sub-path }}

          # GitHub release
          github-release-enabled: ${{ inputs.github-release-enabled }}
          github-release-substituted-files: ${{ inputs.github-release-substituted-files }}
          github-release-verbatim-files: ${{ inputs.github-release-verbatim-files }}
          github-release-notes: ${{ inputs.github-release-notes }}
          github-release-add-version-to-filenames: ${{ inputs.github-release-add-version-to-filenames }}

          # === Step Outputs ===
          # Version outputs (from versions-and-naming)
          version: ${{ steps.versions.outputs.version }}
          version-major: ${{ steps.versions.outputs.version-major }}
          version-minor: ${{ steps.versions.outputs.version-minor }}
          version-patch: ${{ steps.versions.outputs.version-patch }}
          version-2-part: ${{ steps.versions.outputs.version-2-part }}
          version-3-part: ${{ steps.versions.outputs.version-3-part }}
          version-4-part: ${{ steps.versions.outputs.version-4-part }}
          docker-tag: ${{ steps.versions.outputs.docker-tag }}
          docker-image-name: ${{ steps.versions.outputs.docker-image-name }}
          git-tag: ${{ steps.versions.outputs.git-tag }}
          project-name: ${{ steps.versions.outputs.project-name }}
          is-release: ${{ steps.versions.outputs.is-release }}
          # Docker outputs (from docker-build - empty in manifests-only workflows)
          docker-substituted-sub-path: ${{ steps.docker-build.outputs.docker-substituted-sub-path }}
          target-image-full-uri: ${{ steps.docker-build.outputs.docker-target-image-full-uri }}
          # Manifest outputs (from manifest-package)
          manifests-substituted-sub-path: ${{ inputs.output-sub-path }}/manifests/substituted/${{ steps.versions.outputs.project-name }}
          manifests-zip-sub-path: ${{ steps.manifest-package.outputs.manifests-zip-sub-path }}
          manifests-zip-file-name: ${{ steps.manifest-package.outputs.manifests-zip-file-name }}
          # Manifest repo provider outputs (from manifest-repo-provider-package)
          manifests-uri: ${{ steps.manifest-repo-provider-package.outputs.manifests-uri }}
      - name: Pass check - Post-package Tests
        if: inputs.hook-post-package-tests-script-sub-path != '' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-post-package.outputs.check-run-id }}
      - name: Fail check - Post-package Tests
        if: inputs.hook-post-package-tests-script-sub-path != '' && failure() && steps.check-post-package.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-post-package.outputs.check-run-id }}

      # === GitHub Release Prepare ===
      - name: Start check - GitHub Release Prepare
        if: inputs.github-release-enabled == true && success()
        id: check-github-release-prepare
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → GitHub Release Prepare'
      # Copy manifests zip directly (already has version in filename, binary file)
      - name: Copy manifests zip to release directory
        if: inputs.github-release-enabled == true && success()
        shell: bash
        run: |
          mkdir -p "${{ inputs.output-sub-path }}/github-release"
          cp "${{ steps.manifest-package.outputs.manifests-zip-sub-path }}/${{ steps.manifest-package.outputs.manifests-zip-file-name }}" \
             "${{ inputs.output-sub-path }}/github-release/"

      - name: Prepare release files
        id: github-release-prepare
        if: inputs.github-release-enabled == true && success()
        uses: ./.github/buildon-github-actions/src/actions/github-release-prepare
        with:
          github-release-substituted-files: ${{ inputs.github-release-substituted-files }}
          github-release-verbatim-files: ${{ inputs.github-release-verbatim-files }}
          output-sub-path: ${{ inputs.output-sub-path }}
          version: ${{ steps.versions.outputs.version }}
          project-name: ${{ steps.versions.outputs.project-name }}
          docker-tag: ${{ steps.versions.outputs.docker-tag }}
          docker-image-name: ${{ steps.versions.outputs.docker-image-name }}
          is-release: ${{ steps.versions.outputs.is-release }}
          github-release-add-version-to-filenames: ${{ inputs.github-release-add-version-to-filenames }}
          token-delimiter-style: ${{ inputs.token-delimiter-style }}
          token-name-style: ${{ inputs.token-name-style }}
          token-name-validation: ${{ inputs.token-name-validation }}
          config-sub-path: ${{ inputs.config-sub-path }}
          allow-builtin-token-override: ${{ inputs.allow-builtin-token-override }}
          config-value-trailing-newline: ${{ inputs.config-value-trailing-newline }}
          docker-image-full-uri: ${{ steps.docker-build.outputs.docker-target-image-full-uri }}
          target-registry: ${{ inputs.docker-target-registry }}
          target-base-path: ${{ inputs.docker-target-base-path }}
          manifests-zip-file-name: ${{ steps.manifest-package.outputs.manifests-zip-file-name }}
      - name: Pass check - GitHub Release Prepare
        if: inputs.github-release-enabled == true && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-github-release-prepare.outputs.check-run-id }}
      - name: Fail check - GitHub Release Prepare
        if: inputs.github-release-enabled == true && failure() && steps.check-github-release-prepare.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-github-release-prepare.outputs.check-run-id }}

      # === Git Tag Push ===
      - name: Start check - Git Tag Push
        if: steps.versions.outputs.is-release == 'true' && success()
        id: check-git-push-tag
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Git Tag Push'
      - name: Push git tag
        if: steps.versions.outputs.is-release == 'true' && success()
        uses: ./.github/buildon-github-actions/src/actions/git-push-tag
        with:
          git-tag: ${{ steps.versions.outputs.git-tag }}
          is-release: ${{ steps.versions.outputs.is-release }}
      - name: Pass check - Git Tag Push
        if: steps.versions.outputs.is-release == 'true' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-git-push-tag.outputs.check-run-id }}
      - name: Fail check - Git Tag Push
        if: steps.versions.outputs.is-release == 'true' && failure() && steps.check-git-push-tag.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-git-push-tag.outputs.check-run-id }}

      # === Manifest Repo Provider Publish ===
      - name: Start check - Publish Manifests via Repo Provider
        if: steps.versions.outputs.is-release == 'true' && success()
        id: check-manifest-repo-provider-publish
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Publish Manifests via Repo Provider'
      - name: Publish manifests via repo provider
        id: manifest-repo-provider-publish
        if: steps.versions.outputs.is-release == 'true' && success()
        uses: ./.github/buildon-github-actions/src/actions/kubernetes-manifests-repo-provider-publish
        with:
          manifests-repo-provider-type: ${{ inputs.manifests-repo-provider-type }}
          manifests-uri: ${{ steps.manifest-repo-provider-package.outputs.manifests-uri }}
          manifests-zip-sub-path: ${{ steps.manifest-repo-provider-package.outputs.manifests-zip-sub-path }}
          manifests-zip-file-name: ${{ steps.manifest-repo-provider-package.outputs.manifests-zip-file-name }}
          version: ${{ steps.manifest-repo-provider-package.outputs.version }}
          is-release: ${{ steps.versions.outputs.is-release }}
          repo-provider-url: ${{ steps.manifest-repo-provider-package.outputs.repo-provider-url }}
          repo-provider-namespace: ${{ steps.manifest-repo-provider-package.outputs.repo-provider-namespace }}
          repo-provider-name: ${{ steps.manifest-repo-provider-package.outputs.repo-provider-name }}
          repo-provider-version: ${{ steps.manifest-repo-provider-package.outputs.repo-provider-version }}
      - name: Pass check - Publish Manifests via Repo Provider
        if: steps.versions.outputs.is-release == 'true' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-manifest-repo-provider-publish.outputs.check-run-id }}
      - name: Fail check - Publish Manifests via Repo Provider
        if: steps.versions.outputs.is-release == 'true' && failure() && steps.check-manifest-repo-provider-publish.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-manifest-repo-provider-publish.outputs.check-run-id }}

      # === Manifest Multi-Push ===
      - name: Start check - Manifest Multi-Push
        if: inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker' && success()
        id: check-manifest-multi-push
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → Manifest Multi-Push'
      - name: Push manifest images to additional registries
        id: manifest-multi-push
        if: inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker' && success()
        uses: ./.github/buildon-github-actions/src/actions/docker-multi-push
        with:
          docker-image-name: ${{ steps.versions.outputs.docker-image-name }}
          docker-tag: ${{ steps.versions.outputs.docker-tag }}-manifests
          docker-push-targets: ${{ inputs.docker-push-targets }}
          is-release: ${{ steps.versions.outputs.is-release }}
      - name: Pass check - Manifest Multi-Push
        if: inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-manifest-multi-push.outputs.check-run-id }}
      - name: Fail check - Manifest Multi-Push
        if: inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker' && failure() && steps.check-manifest-multi-push.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-manifest-multi-push.outputs.check-run-id }}

      # === GitHub Release ===
      - name: Start check - GitHub Release
        if: inputs.github-release-enabled == true && steps.versions.outputs.is-release == 'true' && success()
        id: check-github-release
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: start
          check-name: 'Build & Publish → GitHub Release'
      - name: Compute release notes
        id: release-notes
        if: inputs.github-release-enabled == true && steps.versions.outputs.is-release == 'true' && success()
        shell: bash
        env:
          USER_NOTES: ${{ inputs.github-release-notes }}
          VERSION: ${{ steps.versions.outputs.version }}
          PROJECT_NAME: ${{ steps.versions.outputs.project-name }}
          MANIFESTS_URI: ${{ steps.manifest-repo-provider-publish.outputs.manifests-uri }}
          MANIFESTS_ZIP_FILE_NAME: ${{ steps.manifest-package.outputs.manifests-zip-file-name }}
          GITHUB_SERVER_URL: ${{ github.server_url }}
          GITHUB_REPOSITORY: ${{ github.repository }}
        run: |
          display_name=$(./.github/buildon-github-actions/src/scripts/util/format-project-title "${PROJECT_NAME}")
          echo "title=${VERSION} — ${display_name}" >> "${GITHUB_OUTPUT}"

          if [[ -n "${USER_NOTES}" ]]; then
            # User provided notes override entirely
            {
              echo "notes<<NOTES_EOF"
              echo "${USER_NOTES}"
              echo "NOTES_EOF"
            } >> "${GITHUB_OUTPUT}"
          else
            # Default format
            release_url="${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/releases/download/${VERSION}"
            {
              echo "notes<<NOTES_EOF"
              echo "Automatic Kube Manifests release for version ${VERSION} of ${PROJECT_NAME} by Kaptain build script. This release page has the manifest zip attached as well as the manifests docker image with the same zip inside for automatic consumption."
              echo ""
              echo "### Release Assets"
              echo "* Kube Manifests: [${MANIFESTS_ZIP_FILE_NAME}](${release_url}/${MANIFESTS_ZIP_FILE_NAME})"
              echo "* Manifests Image: [${MANIFESTS_URI}](https://${MANIFESTS_URI})"
              echo "NOTES_EOF"
            } >> "${GITHUB_OUTPUT}"
          fi

      - name: GitHub Release
        if: inputs.github-release-enabled == true && steps.versions.outputs.is-release == 'true' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-release
        with:
          github-release-enabled: ${{ inputs.github-release-enabled }}
          output-sub-path: ${{ inputs.output-sub-path }}
          github-release-tag: ${{ steps.versions.outputs.version }}
          github-release-notes: ${{ steps.release-notes.outputs.notes }}
          github-release-title: ${{ steps.release-notes.outputs.title }}
      - name: Pass check - GitHub Release
        if: inputs.github-release-enabled == true && steps.versions.outputs.is-release == 'true' && success()
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: pass
          check-run-id: ${{ steps.check-github-release.outputs.check-run-id }}
      - name: Fail check - GitHub Release
        if: inputs.github-release-enabled == true && steps.versions.outputs.is-release == 'true' && failure() && steps.check-github-release.outputs.check-run-id != ''
        uses: ./.github/buildon-github-actions/src/actions/github-check-run
        with:
          action: fail
          check-run-id: ${{ steps.check-github-release.outputs.check-run-id }}
