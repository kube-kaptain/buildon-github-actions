# SPDX-License-Identifier: MIT
# Copyright (c) 2025-2026 Kaptain contributors (Fred Cooke)

name: Kubernetes App - Docker Retag
kaptain-order: 80
kaptain-description: Everything from both docker retag and Kubernetes manifest packaging - for apps using upstream images
on:
  workflow_call:
    inputs:
      # Build output
      output-sub-path:
        description: 'Build output directory (relative)'
        required: false
        type: string
        default: 'target'

      # Docker registry logins
      docker-registry-logins:
        description: 'YAML config for Docker registry logins (registry URL as key)'
        required: false
        type: string
        default: ''
      # Docker source image configuration
      docker-source-registry:
        description: 'Upstream registry (e.g., docker.io)'
        required: true
        type: string
      docker-source-base-path:
        description: 'Path between registry and image name (e.g., library)'
        required: false
        type: string
        default: ''
      docker-source-image-name:
        description: 'Upstream image name (e.g., nginx)'
        required: true
        type: string
      docker-source-tag:
        description: 'Upstream image tag (e.g., 1.25)'
        required: true
        type: string
      # Docker target config
      docker-target-registry:
        description: 'Target container registry'
        required: false
        type: string
        default: 'ghcr.io'
      docker-target-base-path:
        description: 'Path between registry and image name (auto-set for GHCR)'
        required: false
        type: string
        default: ''
      # Docker push targets
      docker-push-targets:
        description: 'JSON array of additional push targets [{registry, base-path?}]'
        required: false
        type: string
        default: ''

      # Manifests source
      manifests-sub-path:
        description: 'Directory containing Kubernetes manifests (relative)'
        required: false
        type: string
        default: 'src/kubernetes'
      # Manifests packaging
      manifests-repo-provider-type:
        description: 'Repo provider type for manifest storage (default: docker, currently the only supported provider)'
        required: false
        type: string
        default: 'docker'
      manifests-packaging-base-image:
        description: 'Base image for manifest packaging (default: scratch)'
        required: false
        type: string
        default: ''

      # Kubernetes generation
      kubernetes-global-additional-labels:
        description: 'Additional labels for all Kubernetes manifests (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-global-additional-annotations:
        description: 'Additional annotations for all Kubernetes manifests (comma-separated key=value)'
        required: false
        type: string
        default: ''
      # Kubernetes ConfigMap generation
      kubernetes-configmap-sub-path:
        description: 'Directory containing ConfigMap data files (relative)'
        required: false
        type: string
        default: 'src/configmap'
      kubernetes-configmap-name-checksum-injection:
        description: 'Enable checksum injection suffix in ConfigMap name (true: ProjectName-configmap-checksum, false: ProjectName)'
        required: false
        type: boolean
        default: true
      kubernetes-configmap-additional-labels:
        description: 'Additional labels specific to ConfigMap (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-configmap-additional-annotations:
        description: 'Additional annotations specific to ConfigMap (comma-separated key=value)'
        required: false
        type: string
        default: ''
      # Kubernetes Secret template generation
      kubernetes-secret-template-sub-path:
        description: 'Directory containing Secret template data files (relative)'
        required: false
        type: string
        default: 'src/secret.template'
      kubernetes-secret-template-name-checksum-injection:
        description: 'Enable checksum injection suffix in Secret name (true: ProjectName-secret-checksum, false: ProjectName)'
        required: false
        type: boolean
        default: true
      kubernetes-secret-template-additional-labels:
        description: 'Additional labels specific to Secret template (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-secret-template-additional-annotations:
        description: 'Additional annotations specific to Secret template (comma-separated key=value)'
        required: false
        type: string
        default: ''
      # Kubernetes ServiceAccount generation
      kubernetes-serviceaccount-generation-enabled:
        description: 'Enable ServiceAccount generation (true/false)'
        required: false
        type: boolean
        default: false
      kubernetes-serviceaccount-name-suffix:
        description: 'Optional suffix for ServiceAccount name and filename'
        required: false
        type: string
        default: ''
      kubernetes-serviceaccount-combined-sub-path:
        description: 'Sub-path within combined/ for output'
        required: false
        type: string
        default: ''
      kubernetes-serviceaccount-additional-labels:
        description: 'Additional labels specific to ServiceAccount (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-serviceaccount-additional-annotations:
        description: 'Additional annotations specific to ServiceAccount (comma-separated key=value)'
        required: false
        type: string
        default: ''
      # Kubernetes Workload generation
      kubernetes-workload-type:
        description: 'Workload type to generate (deployment, none)'
        required: false
        type: string
        default: 'deployment'
      kubernetes-workload-name-suffix:
        description: 'Optional suffix for workload name and filename'
        required: false
        type: string
        default: ''
      kubernetes-workload-combined-sub-path:
        description: 'Sub-path within combined/ for output'
        required: false
        type: string
        default: ''
      kubernetes-workload-env-sub-path:
        description: 'Directory containing environment variable files'
        required: false
        type: string
        default: 'src/workload-env'
      kubernetes-workload-additional-labels:
        description: 'Additional labels specific to workload (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-workload-additional-annotations:
        description: 'Additional annotations specific to workload (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-workload-container-port:
        description: 'Container port'
        required: false
        type: string
        default: '1024'
      kubernetes-workload-image-reference-style:
        description: 'Image reference style (combined, separate, project-name-prefixed-combined, project-name-prefixed-separate)'
        required: false
        type: string
        default: 'combined'
      kubernetes-workload-readonly-root-filesystem:
        description: 'Enable read-only root filesystem'
        required: false
        type: boolean
        default: true
      kubernetes-workload-seccomp-profile:
        description: 'Seccomp profile (DISABLED, RuntimeDefault, Localhost, Unconfined)'
        required: false
        type: string
        default: 'DISABLED'
      kubernetes-workload-automount-service-account-token:
        description: 'Automount service account token'
        required: false
        type: boolean
        default: false
      kubernetes-workload-resources-memory:
        description: 'Memory limit (e.g., 128Mi, 1Gi)'
        required: false
        type: string
        default: '10Mi'
      kubernetes-workload-resources-cpu-request:
        description: 'CPU request (e.g., 100m, 1)'
        required: false
        type: string
        default: '100m'
      kubernetes-workload-resources-cpu-limit:
        description: 'CPU limit (empty for no limit)'
        required: false
        type: string
        default: ''
      kubernetes-workload-configmap-mount-path:
        description: 'ConfigMap mount path in container'
        required: false
        type: string
        default: '/configmap'
      kubernetes-workload-secret-mount-path:
        description: 'Secret mount path in container'
        required: false
        type: string
        default: '/secret'
      kubernetes-workload-termination-grace-period-seconds:
        description: 'Termination grace period in seconds'
        required: false
        type: string
        default: '10'
      kubernetes-workload-prestop-command:
        description: 'PreStop hook command (empty for none)'
        required: false
        type: string
        default: ''
      kubernetes-workload-affinity-strategy:
        description: 'Pod affinity strategy plugin name'
        required: false
        type: string
        default: 'spread-nodes-and-zones-ha'
      kubernetes-workload-probe-liveness-check-type:
        description: 'Liveness probe type (http-get, tcp-socket, exec, grpc, none)'
        required: false
        type: string
        default: 'http-get'
      kubernetes-workload-probe-readiness-check-type:
        description: 'Readiness probe type (http-get, tcp-socket, exec, grpc, none)'
        required: false
        type: string
        default: 'http-get'
      kubernetes-workload-probe-startup-check-type:
        description: 'Startup probe type (http-get, tcp-socket, exec, grpc, none)'
        required: false
        type: string
        default: 'http-get'
      kubernetes-workload-probe-liveness-http-path:
        description: 'Liveness probe HTTP path'
        required: false
        type: string
        default: '/liveness'
      kubernetes-workload-probe-readiness-http-path:
        description: 'Readiness probe HTTP path'
        required: false
        type: string
        default: '/readiness'
      kubernetes-workload-probe-startup-http-path:
        description: 'Startup probe HTTP path'
        required: false
        type: string
        default: '/startup'
      kubernetes-deployment-replicas:
        description: 'Replica count (empty for token, NO for HPA management)'
        required: false
        type: string
        default: ''
      kubernetes-deployment-revision-history-limit:
        description: 'Number of old ReplicaSets to retain'
        required: false
        type: string
        default: '10'
      # Kubernetes Service generation
      kubernetes-service-generation-enabled:
        description: 'Enable Service generation'
        required: false
        type: boolean
        default: false
      kubernetes-service-type:
        description: 'Service type (ClusterIP, NodePort, LoadBalancer)'
        required: false
        type: string
        default: 'ClusterIP'
      kubernetes-service-port:
        description: 'Service port'
        required: false
        type: string
        default: '80'
      kubernetes-service-target-port:
        description: 'Target port (defaults to service port)'
        required: false
        type: string
        default: ''
      kubernetes-service-protocol:
        description: 'Protocol (TCP, UDP, SCTP)'
        required: false
        type: string
        default: 'TCP'
      kubernetes-service-name-suffix:
        description: 'Optional suffix for Service name and filename'
        required: false
        type: string
        default: ''
      kubernetes-service-combined-sub-path:
        description: 'Sub-path within combined/ for output'
        required: false
        type: string
        default: ''
      kubernetes-service-additional-labels:
        description: 'Additional labels specific to Service (comma-separated key=value)'
        required: false
        type: string
        default: ''
      kubernetes-service-additional-annotations:
        description: 'Additional annotations specific to Service (comma-separated key=value)'
        required: false
        type: string
        default: ''

      # Token substitution
      token-delimiter-style:
        description: 'Token delimiter syntax for variables (shell, mustache, helm, erb, github-actions, blade, stringtemplate, ognl, t4, swift)'
        required: false
        type: string
        default: 'shell'
      token-name-style:
        description: 'Case style for token names (UPPER_SNAKE, lower_snake, lower-kebab, UPPER-KEBAB, camelCase, PascalCase, lower.dot, UPPER.DOT)'
        required: false
        type: string
        default: 'PascalCase'
      token-name-validation:
        description: 'How to validate user token names (MATCH = must match token-name-style, ALL = accept any valid name)'
        required: false
        type: string
        default: 'MATCH'
      allow-builtin-token-override:
        description: 'Allow user tokens to override built-in tokens (for template/reusable projects)'
        required: false
        type: boolean
        default: false
      config-sub-path:
        description: 'Directory containing user-defined token files (relative)'
        required: false
        type: string
        default: 'src/config'
      config-value-trailing-newline:
        description: 'How to handle trailing newlines in config values (strip-for-single-line, preserve-all, always-strip-one-newline)'
        required: false
        type: string
        default: 'strip-for-single-line'

      # Naming, Versions, and Tags calculation
      release-branch:
        description: 'The release branch name'
        required: false
        type: string
        default: 'main'
      additional-release-branches:
        description: 'Comma-separated list of additional release branches'
        required: false
        type: string
        default: ''
      tag-version-max-parts:
        description: 'Maximum allowed version parts (fail if exceeded)'
        required: false
        type: number
        default: 3
      tag-version-calculation-strategy:
        description: 'Strategy for calculating version (git-auto-closest-highest, file-pattern-match)'
        required: false
        type: string
        default: 'git-auto-closest-highest'
      tag-version-pattern-type:
        description: 'Pattern type for file-pattern-match strategy (dockerfile-env-kubectl, retag-workflow-source-tag, custom)'
        required: false
        type: string
        default: 'dockerfile-env-kubectl'
      tag-version-prefix-parts:
        description: 'Number of parts from source version to use as prefix (default 2, output = prefix + 1 parts)'
        required: false
        type: string
        default: ''
      dockerfile-sub-path:
        description: 'Directory containing Dockerfile, relative to repo root.'
        required: false
        type: string
        default: 'src/docker'
      tag-version-source-sub-path:
        description: 'Override path to source directory (takes precedence over dockerfile-sub-path)'
        required: false
        type: string
        default: ''
      tag-version-source-file-name:
        description: 'Override source file name (defaults based on pattern type)'
        required: false
        type: string
        default: ''
      tag-version-source-custom-pattern:
        description: 'Regex with capture group for version extraction (required for custom pattern type)'
        required: false
        type: string
        default: ''

      # Quality check options
      block-slashes:
        description: 'DEPRECATED: Use block-slash-containing-branches instead'
        required: false
        type: boolean
        default: false
      qc-block-slash-containing-branches:
        description: 'Block branch names containing slashes'
        required: false
        type: boolean
        default: false
      qc-block-double-hyphen-containing-branches:
        description: 'Block branch names containing double hyphens (typo detection)'
        required: false
        type: boolean
        default: true
      qc-require-conventional-branches:
        description: 'Require branch names start with feature/, fix/, etc.'
        required: false
        type: boolean
        default: false
      qc-require-conventional-commits:
        description: 'Require commits use conventional commit format (feat:, fix:, etc.)'
        required: false
        type: boolean
        default: false
      qc-block-conventional-commits:
        description: 'Block commits that use conventional commit format'
        required: false
        type: boolean
        default: false

      # Hook script paths
      hook-pre-tagging-tests-script-sub-path:
        description: 'Path to pre-tagging test script relative to .github/ (e.g., bin/pre-tagging.bash)'
        required: false
        type: string
        default: ''
      hook-pre-package-prepare-script-sub-path:
        description: 'Path to pre-package prepare script relative to .github/ (e.g., bin/pre-package-prepare.bash)'
        required: false
        type: string
        default: ''
      hook-post-package-tests-script-sub-path:
        description: 'Path to post-package test script relative to .github/ (e.g., bin/post-package.bash)'
        required: false
        type: string
        default: ''

      # GitHub release
      github-release-enabled:
        description: 'Create a GitHub release on version tags'
        required: false
        type: boolean
        default: true
      github-release-substituted-files:
        description: 'Files with token substitution and version suffix (space-separated)'
        required: false
        type: string
        default: ''
      github-release-verbatim-files:
        description: 'Files copied as-is with version suffix only (space-separated)'
        required: false
        type: string
        default: ''
      github-release-notes:
        description: 'Release notes (leave empty for auto-generated)'
        required: false
        type: string
        default: ''
      github-release-add-version-to-filenames:
        description: 'Add version suffix to release filenames (e.g., file.yaml -> file-1.2.3.yaml)'
        required: false
        type: boolean
        default: true
    secrets:
      docker-registry-logins-secrets:
        description: 'JSON object of secrets for docker-registry-logins (e.g., {"DOCKER_USER": "x", "DOCKER_PASS": "y"})'
        required: false
    outputs:
      # Version outputs
      version:
        description: 'The generated version'
        value: ${{ jobs.build.outputs.version }}
      version-major:
        description: 'Major version number'
        value: ${{ jobs.build.outputs.version-major }}
      version-minor:
        description: 'Minor version number'
        value: ${{ jobs.build.outputs.version-minor }}
      version-patch:
        description: 'Patch version number'
        value: ${{ jobs.build.outputs.version-patch }}
      version-2-part:
        description: 'Version padded/truncated to 2 parts'
        value: ${{ jobs.build.outputs.version-2-part }}
      version-3-part:
        description: 'Version padded/truncated to 3 parts'
        value: ${{ jobs.build.outputs.version-3-part }}
      version-4-part:
        description: 'Version padded/truncated to 4 parts'
        value: ${{ jobs.build.outputs.version-4-part }}
      docker-tag:
        description: 'Tag for Docker images'
        value: ${{ jobs.build.outputs.docker-tag }}
      docker-image-name:
        description: 'Docker image name'
        value: ${{ jobs.build.outputs.docker-image-name }}
      git-tag:
        description: 'Tag for git'
        value: ${{ jobs.build.outputs.git-tag }}
      project-name:
        description: 'The repository/project name'
        value: ${{ jobs.build.outputs.project-name }}
      is-release:
        description: 'Whether this is a release build'
        value: ${{ jobs.build.outputs.is-release }}
      # Docker retag outputs
      docker-source-image-full-uri:
        description: 'Full source image reference'
        value: ${{ jobs.build.outputs.docker-source-image-full-uri }}
      docker-target-image-full-uri:
        description: 'Full target image reference'
        value: ${{ jobs.build.outputs.docker-target-image-full-uri }}
      docker-image-full-uri:
        description: 'Full docker image reference (alias for docker-target-image-full-uri)'
        value: ${{ jobs.build.outputs.docker-target-image-full-uri }}
      docker-image-pushed:
        description: 'Whether docker image was pushed'
        value: ${{ jobs.build.outputs.docker-image-pushed }}
      # Manifest package outputs
      manifests-zip-sub-path:
        description: 'Directory containing manifests zip file (relative)'
        value: ${{ jobs.build.outputs.manifests-zip-sub-path }}
      manifests-zip-file-name:
        description: 'Name of manifests zip file'
        value: ${{ jobs.build.outputs.manifests-zip-file-name }}
      # Manifest repo provider publish outputs
      manifests-uri:
        description: 'Reference to published manifests (format depends on repo provider)'
        value: ${{ jobs.build.outputs.manifests-uri }}
      manifests-published:
        description: 'Whether manifests were published'
        value: ${{ jobs.build.outputs.manifests-published }}
jobs:
  basic-quality-checks:
    name: Basic Quality Checks
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-24.04
    permissions:
      contents: read
    steps:
      # INJECT: parse-workflow-ref-and-checkout
      # INJECT: basic-quality-checks
  build:
    name: Build & Publish
    needs: basic-quality-checks
    if: always() && (needs.basic-quality-checks.result == 'success' || needs.basic-quality-checks.result == 'skipped')
    runs-on: ubuntu-24.04
    permissions:
      contents: write
      packages: write
      checks: write
    outputs:
      version: ${{ steps.versions.outputs.version }}
      version-major: ${{ steps.versions.outputs.version-major }}
      version-minor: ${{ steps.versions.outputs.version-minor }}
      version-patch: ${{ steps.versions.outputs.version-patch }}
      version-2-part: ${{ steps.versions.outputs.version-2-part }}
      version-3-part: ${{ steps.versions.outputs.version-3-part }}
      version-4-part: ${{ steps.versions.outputs.version-4-part }}
      docker-tag: ${{ steps.versions.outputs.docker-tag }}
      docker-image-name: ${{ steps.versions.outputs.docker-image-name }}
      git-tag: ${{ steps.versions.outputs.git-tag }}
      project-name: ${{ steps.versions.outputs.project-name }}
      is-release: ${{ steps.versions.outputs.is-release }}
      docker-source-image-full-uri: ${{ steps.docker-build.outputs.docker-source-image-full-uri }}
      docker-target-image-full-uri: ${{ steps.docker-build.outputs.docker-target-image-full-uri }}
      docker-image-pushed: ${{ steps.docker-push.outputs.image-pushed }}
      manifests-zip-sub-path: ${{ steps.manifest-package.outputs.manifests-zip-sub-path }}
      manifests-zip-file-name: ${{ steps.manifest-package.outputs.manifests-zip-file-name }}
      manifests-uri: ${{ steps.manifest-repo-provider-publish.outputs.manifests-uri }}
      manifests-published: ${{ steps.manifest-repo-provider-publish.outputs.manifests-published }}
    steps:
      # INJECT: parse-workflow-ref-and-checkout

      # === Docker Registry Logins ===
      # INJECT: docker-registry-logins

      # === Pre-tagging Tests ===
      # INJECT: github-check-start(name="Pre-tagging Tests", id="check-pre-tagging", if="inputs.hook-pre-tagging-tests-script-sub-path != ''")
      # INJECT: hook-pre-tagging-tests
      # INJECT: github-check-end(name="Pre-tagging Tests", id="check-pre-tagging", if="inputs.hook-pre-tagging-tests-script-sub-path != ''")

      # === Versions & Naming ===
      # INJECT: github-check-start(name="Versions & Naming", id="check-versions")
      # INJECT: versions-and-naming
      # INJECT: github-check-end(name="Versions & Naming", id="check-versions")

      # === Docker Retag ===
      # INJECT: github-check-start(name="Docker Retag", id="check-docker-retag")
      # INJECT: docker-build-retag
      # INJECT: github-check-end(name="Docker Retag", id="check-docker-retag")

      # === Docker Multi-Tag ===
      # INJECT: github-check-start(name="Docker Multi-Tag", id="check-docker-multi-tag", if="inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true'")
      # INJECT: docker-multi-tag
      # INJECT: github-check-end(name="Docker Multi-Tag", id="check-docker-multi-tag", if="inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true'")

      # === Generate ConfigMap ===
      # INJECT: github-check-start(name="Generate ConfigMap", id="check-generate-configmap", if="inputs.kubernetes-configmap-sub-path != ''")
      # INJECT: generate-kubernetes-configmap
      # INJECT: github-check-end(name="Generate ConfigMap", id="check-generate-configmap", if="inputs.kubernetes-configmap-sub-path != ''")

      # === Generate Secret Template ===
      # INJECT: github-check-start(name="Generate Secret Template", id="check-generate-secret-template", if="inputs.kubernetes-secret-template-sub-path != ''")
      # INJECT: generate-kubernetes-secret-template
      # INJECT: github-check-end(name="Generate Secret Template", id="check-generate-secret-template", if="inputs.kubernetes-secret-template-sub-path != ''")

      # === Generate ServiceAccount ===
      # INJECT: github-check-start(name="Generate ServiceAccount", id="check-generate-serviceaccount", if="inputs.kubernetes-serviceaccount-generation-enabled == true")
      # INJECT: generate-kubernetes-serviceaccount
      # INJECT: github-check-end(name="Generate ServiceAccount", id="check-generate-serviceaccount", if="inputs.kubernetes-serviceaccount-generation-enabled == true")

      # === Generate Workload ===
      # INJECT: github-check-start(name="Generate Workload", id="check-generate-workload", if="inputs.kubernetes-workload-type != 'none'")
      # INJECT: generate-kubernetes-workload
      # INJECT: github-check-end(name="Generate Workload", id="check-generate-workload", if="inputs.kubernetes-workload-type != 'none'")

      # === Generate Service ===
      # INJECT: github-check-start(name="Generate Service", id="check-generate-service", if="inputs.kubernetes-service-generation-enabled == true && inputs.kubernetes-workload-type == 'deployment'")
      # INJECT: generate-kubernetes-service
      # INJECT: github-check-end(name="Generate Service", id="check-generate-service", if="inputs.kubernetes-service-generation-enabled == true && inputs.kubernetes-workload-type == 'deployment'")

      # === Pre-package Prepare ===
      # INJECT: github-check-start(name="Pre-package Prepare", id="check-pre-package-prepare", if="inputs.hook-pre-package-prepare-script-sub-path != ''")
      # INJECT: hook-pre-package-prepare
      # INJECT: github-check-end(name="Pre-package Prepare", id="check-pre-package-prepare", if="inputs.hook-pre-package-prepare-script-sub-path != ''")

      # === Manifest Package ===
      # INJECT: github-check-start(name="Package Manifests", id="check-manifest-package")
      # INJECT: manifest-package
      # INJECT: github-check-end(name="Package Manifests", id="check-manifest-package")

      # === Manifest Repo Provider Package ===
      # INJECT: github-check-start(name="Package Manifests for Repo Provider", id="check-manifest-repo-provider-package")
      # INJECT: manifest-repo-provider-package
      # INJECT: github-check-end(name="Package Manifests for Repo Provider", id="check-manifest-repo-provider-package")

      # === Manifest Multi-Tag ===
      # INJECT: github-check-start(name="Manifest Multi-Tag", id="check-manifest-multi-tag", if="inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker'")
      # INJECT: manifest-multi-tag
      # INJECT: github-check-end(name="Manifest Multi-Tag", id="check-manifest-multi-tag", if="inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker'")

      # === Post-package Tests ===
      # INJECT: github-check-start(name="Post-package Tests", id="check-post-package", if="inputs.hook-post-package-tests-script-sub-path != ''")
      # INJECT: hook-post-package-tests
      # INJECT: github-check-end(name="Post-package Tests", id="check-post-package", if="inputs.hook-post-package-tests-script-sub-path != ''")

      # === GitHub Release Prepare ===
      # INJECT: github-check-start(name="GitHub Release Prepare", id="check-github-release-prepare", if="inputs.github-release-enabled == true")
      # INJECT: github-release-prepare-kube-app
      # INJECT: github-check-end(name="GitHub Release Prepare", id="check-github-release-prepare", if="inputs.github-release-enabled == true")

      # === Git Tag Push ===
      # INJECT: github-check-start(name="Git Tag Push", id="check-git-push-tag", if="steps.versions.outputs.is-release == 'true'")
      # INJECT: git-push-tag
      # INJECT: github-check-end(name="Git Tag Push", id="check-git-push-tag", if="steps.versions.outputs.is-release == 'true'")

      # === Docker Push ===
      # INJECT: github-check-start(name="Docker Push", id="check-docker-push", if="steps.versions.outputs.is-release == 'true'")
      # INJECT: docker-push
      # INJECT: github-check-end(name="Docker Push", id="check-docker-push", if="steps.versions.outputs.is-release == 'true'")

      # === Docker Multi-Push ===
      # INJECT: github-check-start(name="Docker Multi-Push", id="check-docker-multi-push", if="inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true'")
      # INJECT: docker-multi-push
      # INJECT: github-check-end(name="Docker Multi-Push", id="check-docker-multi-push", if="inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true'")

      # === Manifest Repo Provider Publish ===
      # INJECT: github-check-start(name="Publish Manifests via Repo Provider", id="check-manifest-repo-provider-publish", if="steps.versions.outputs.is-release == 'true'")
      # INJECT: manifest-repo-provider-publish
      # INJECT: github-check-end(name="Publish Manifests via Repo Provider", id="check-manifest-repo-provider-publish", if="steps.versions.outputs.is-release == 'true'")

      # === Manifest Multi-Push ===
      # INJECT: github-check-start(name="Manifest Multi-Push", id="check-manifest-multi-push", if="inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker'")
      # INJECT: manifest-multi-push
      # INJECT: github-check-end(name="Manifest Multi-Push", id="check-manifest-multi-push", if="inputs.docker-push-targets != '' && steps.versions.outputs.is-release == 'true' && inputs.manifests-repo-provider-type == 'docker'")

      # === GitHub Release ===
      # INJECT: github-check-start(name="GitHub Release", id="check-github-release", if="inputs.github-release-enabled == true && steps.versions.outputs.is-release == 'true'")
      # INJECT: github-release-kube-app
      # INJECT: github-check-end(name="GitHub Release", id="check-github-release", if="inputs.github-release-enabled == true && steps.versions.outputs.is-release == 'true'")
