#!/usr/bin/env bash
# SPDX-License-Identifier: MIT
# Copyright (c) 2025-2026 Kaptain contributors (Fred Cooke)
#
# docker-login-github-token - Login using GitHub token
#
# Usage: docker-login-github-token <secret-method> <registry> <token> <actor>
#
# Arguments:
#   secret-method - Secret retrieval method (unused, accepted for consistency)
#   registry      - Registry URL (typically ghcr.io)
#   token         - GitHub token value
#   actor         - GitHub actor/username
#
set -euo pipefail

# shellcheck source=src/scripts/defaults/docker-common.bash
source "$(dirname "${BASH_SOURCE[0]}")/../../defaults/docker-common.bash"
# shellcheck source=src/scripts/defaults/platform.bash
source "$(dirname "${BASH_SOURCE[0]}")/../../defaults/platform.bash"
# shellcheck source=src/scripts/lib/log.bash
source "$(dirname "${BASH_SOURCE[0]}")/../../lib/log.bash"

# secret_method=$1 - unused, values passed directly
registry="${2}"
token="${3}"
actor="${4}"

if [[ -z "${token}" ]]; then
  log_error "Token not provided"
  exit 1
fi

if [[ -z "${actor}" ]]; then
  log_error "Actor not provided"
  exit 1
fi

log "Logging in to ${registry} with GITHUB_TOKEN..."
echo "${token}" | ${IMAGE_BUILD_COMMAND} login "${registry}" -u "${actor}" --password-stdin
