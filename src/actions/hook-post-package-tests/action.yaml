# SPDX-License-Identifier: MIT
# Copyright (c) 2025-2026 Kaptain contributors (Fred Cooke)

name: Hook - Post-Package Tests
description: Runs user's hook script after manifest packaging for validation, additional tests, or verification

inputs:
  # Hook script path
  script-sub-path:
    description: 'Path to script relative to .github/ (e.g., bin/post-package.bash)'
    required: true

  # === Workflow Inputs ===
  # Build output
  output-sub-path:
    description: 'Build output directory (relative)'
    required: false
    default: 'target'
  # Docker registry logins
  docker-registry-logins:
    description: 'YAML config for Docker registry logins (registry URL as key)'
    required: false
    default: ''
  # Docker target config
  docker-target-registry:
    description: 'Target container registry'
    required: false
    default: 'ghcr.io'
  docker-target-base-path:
    description: 'Path between registry and image name (auto-set for GHCR)'
    required: false
    default: ''
  # Docker push targets
  docker-push-targets:
    description: 'JSON array of additional push targets [{registry, base-path?}]'
    required: false
    default: ''
  # Docker build options
  dockerfile-substitution-files:
    description: 'Comma-separated list of files to perform token substitution on (relative to dockerfile-sub-path)'
    required: false
    default: 'Dockerfile'
  dockerfile-sub-path:
    description: 'Directory containing Dockerfile, relative to repo root.'
    required: false
    default: 'src/docker'
  dockerfile-squash:
    description: 'Enable --squash (requires experimental mode)'
    required: false
    default: 'true'
  dockerfile-no-cache:
    description: 'Disable layer caching for reproducible builds'
    required: false
    default: 'true'
  # Manifests source
  manifests-sub-path:
    description: 'Directory containing Kubernetes manifests (relative)'
    required: false
    default: 'src/kubernetes'
  # Manifests packaging
  manifests-repo-provider-type:
    description: 'Repo provider type for manifest storage (default: docker, currently the only supported provider)'
    required: false
    default: 'docker'
  manifests-packaging-base-image:
    description: 'Base image for manifest packaging (default: scratch)'
    required: false
    default: ''
  # Kubernetes generation
  kubernetes-global-additional-labels:
    description: 'Additional labels for all Kubernetes manifests (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-global-additional-annotations:
    description: 'Additional annotations for all Kubernetes manifests (comma-separated key=value)'
    required: false
    default: ''
  # Kubernetes ConfigMap generation
  kubernetes-configmap-sub-path:
    description: 'Directory containing ConfigMap data files (relative)'
    required: false
    default: 'src/configmap'
  kubernetes-configmap-name-checksum-injection:
    description: 'Enable checksum injection suffix in ConfigMap name'
    required: false
    default: 'true'
  kubernetes-configmap-additional-labels:
    description: 'Additional labels specific to ConfigMap (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-configmap-additional-annotations:
    description: 'Additional annotations specific to ConfigMap (comma-separated key=value)'
    required: false
    default: ''
  # Kubernetes Secret template generation
  kubernetes-secret-template-sub-path:
    description: 'Directory containing Secret template data files (relative)'
    required: false
    default: 'src/secret.template'
  kubernetes-secret-template-name-checksum-injection:
    description: 'Enable checksum injection suffix in Secret name'
    required: false
    default: 'true'
  kubernetes-secret-template-additional-labels:
    description: 'Additional labels specific to Secret template (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-secret-template-additional-annotations:
    description: 'Additional annotations specific to Secret template (comma-separated key=value)'
    required: false
    default: ''
  # Kubernetes ServiceAccount generation
  kubernetes-serviceaccount-generation-enabled:
    description: 'Enable ServiceAccount generation'
    required: false
    default: 'false'
  kubernetes-serviceaccount-name-suffix:
    description: 'Optional suffix for ServiceAccount name and filename'
    required: false
    default: ''
  kubernetes-serviceaccount-combined-sub-path:
    description: 'Sub-path within combined/ for output'
    required: false
    default: ''
  kubernetes-serviceaccount-additional-labels:
    description: 'Additional labels specific to ServiceAccount (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-serviceaccount-additional-annotations:
    description: 'Additional annotations specific to ServiceAccount (comma-separated key=value)'
    required: false
    default: ''
  # Kubernetes Workload generation
  kubernetes-workload-type:
    description: 'Workload type to generate (deployment, statefulset, daemonset, none)'
    required: false
    default: 'deployment'
  kubernetes-workload-replicas:
    description: 'Replica count (empty for token, NO for HPA management, number for fixed)'
    required: false
    default: ''
  kubernetes-workload-revision-history-limit:
    description: 'Number of revisions to retain (ReplicaSets for Deployment, ControllerRevisions for StatefulSet)'
    required: false
    default: '10'
  kubernetes-workload-name-suffix:
    description: 'Optional suffix for workload name and filename'
    required: false
    default: ''
  kubernetes-workload-combined-sub-path:
    description: 'Sub-path within combined/ for output'
    required: false
    default: ''
  kubernetes-workload-env-sub-path:
    description: 'Directory containing environment variable files (default per workload type)'
    required: false
    default: ''
  kubernetes-workload-additional-labels:
    description: 'Additional labels specific to workload (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-workload-additional-annotations:
    description: 'Additional annotations specific to workload (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-workload-container-port:
    description: 'Container port'
    required: false
    default: '1024'
  kubernetes-workload-container-command:
    description: 'Container command override (space-separated, respects quotes like shell)'
    required: false
    default: ''
  kubernetes-workload-container-args:
    description: 'Container args override (space-separated, respects quotes like shell)'
    required: false
    default: ''
  kubernetes-workload-image-reference-style:
    description: 'Image reference style (combined, separate, project-name-prefixed-combined, project-name-prefixed-separate)'
    required: false
    default: 'combined'
  kubernetes-workload-readonly-root-filesystem:
    description: 'Enable read-only root filesystem'
    required: false
    default: 'true'
  kubernetes-workload-seccomp-profile:
    description: 'Seccomp profile (DISABLED, RuntimeDefault, Localhost, Unconfined)'
    required: false
    default: 'DISABLED'
  kubernetes-workload-automount-service-account-token:
    description: 'Automount service account token'
    required: false
    default: 'false'
  kubernetes-workload-image-pull-secrets:
    description: 'Include imagePullSecrets in pod spec (ENABLED/DISABLED)'
    required: false
    default: 'ENABLED'
  # Resource configuration inputs
  kubernetes-workload-resources-memory:
    description: 'Memory limit (e.g., 128Mi, 1Gi)'
    required: false
    default: '10Mi'
  kubernetes-workload-resources-cpu-request:
    description: 'CPU request (e.g., 100m, 1)'
    required: false
    default: '100m'
  kubernetes-workload-resources-cpu-limit:
    description: 'CPU limit (empty for no limit)'
    required: false
    default: ''
  kubernetes-workload-resources-ephemeral-storage:
    description: 'Ephemeral storage request/limit (e.g., 10Mi, 100Mi, 1Gi)'
    required: false
    default: '10Mi'
  kubernetes-workload-configmap-mount-path:
    description: 'ConfigMap mount path in container'
    required: false
    default: '/configmap'
  kubernetes-workload-secret-mount-path:
    description: 'Secret mount path in container'
    required: false
    default: '/secret'
  kubernetes-workload-configmap-keys-for-env:
    description: 'Comma/space-separated ConfigMap keys to expose as env vars'
    required: false
    default: ''
  kubernetes-workload-secret-keys-for-env:
    description: 'Comma/space-separated Secret keys to expose as env vars'
    required: false
    default: ''
  kubernetes-workload-termination-grace-period-seconds:
    description: 'Termination grace period in seconds'
    required: false
    default: '10'
  kubernetes-workload-prestop-command:
    description: 'PreStop hook command (empty for none)'
    required: false
    default: ''
  kubernetes-workload-affinity-strategy:
    description: 'Pod affinity strategy plugin name'
    required: false
    default: 'spread-nodes-and-zones-ha'
  kubernetes-workload-tolerations:
    description: 'Tolerations as JSON array (e.g., [{"key":"dedicated","operator":"Equal","value":"app","effect":"NoSchedule"}])'
    required: false
    default: ''
  kubernetes-workload-node-selector:
    description: 'Node selector (comma-separated key=value pairs, e.g., disktype=ssd,zone=us-east-1a)'
    required: false
    default: ''
  kubernetes-workload-dns-policy:
    description: 'DNS policy (ClusterFirst, ClusterFirstWithHostNet, Default, None)'
    required: false
    default: ''
  # Liveness probe inputs
  kubernetes-workload-probe-liveness-check-type:
    description: 'Liveness probe type (http-get, tcp-socket, exec, grpc, none)'
    required: false
    default: 'http-get'
  kubernetes-workload-probe-liveness-http-path:
    description: 'Liveness probe HTTP path'
    required: false
    default: '/liveness'
  kubernetes-workload-probe-liveness-http-scheme:
    description: 'Liveness probe HTTP scheme (HTTP, HTTPS)'
    required: false
    default: 'HTTP'
  kubernetes-workload-probe-liveness-tcp-port:
    description: 'Liveness probe TCP port (defaults to container port)'
    required: false
    default: ''
  kubernetes-workload-probe-liveness-exec-command:
    description: 'Liveness probe exec command'
    required: false
    default: ''
  kubernetes-workload-probe-liveness-grpc-port:
    description: 'Liveness probe gRPC port (defaults to container port)'
    required: false
    default: ''
  kubernetes-workload-probe-liveness-grpc-service:
    description: 'Liveness probe gRPC service name'
    required: false
    default: ''
  kubernetes-workload-probe-liveness-initial-delay-seconds:
    description: 'Liveness probe initial delay in seconds'
    required: false
    default: '10'
  kubernetes-workload-probe-liveness-period-seconds:
    description: 'Liveness probe period in seconds'
    required: false
    default: '10'
  kubernetes-workload-probe-liveness-timeout-seconds:
    description: 'Liveness probe timeout in seconds'
    required: false
    default: '5'
  kubernetes-workload-probe-liveness-failure-threshold:
    description: 'Liveness probe failure threshold'
    required: false
    default: '3'
  kubernetes-workload-probe-liveness-termination-grace-period-seconds:
    description: 'Liveness probe termination grace period (empty for default)'
    required: false
    default: ''
  # Readiness probe inputs
  kubernetes-workload-probe-readiness-check-type:
    description: 'Readiness probe type (http-get, tcp-socket, exec, grpc, none)'
    required: false
    default: 'http-get'
  kubernetes-workload-probe-readiness-http-path:
    description: 'Readiness probe HTTP path'
    required: false
    default: '/readiness'
  kubernetes-workload-probe-readiness-http-scheme:
    description: 'Readiness probe HTTP scheme (HTTP, HTTPS)'
    required: false
    default: 'HTTP'
  kubernetes-workload-probe-readiness-tcp-port:
    description: 'Readiness probe TCP port (defaults to container port)'
    required: false
    default: ''
  kubernetes-workload-probe-readiness-exec-command:
    description: 'Readiness probe exec command'
    required: false
    default: ''
  kubernetes-workload-probe-readiness-grpc-port:
    description: 'Readiness probe gRPC port (defaults to container port)'
    required: false
    default: ''
  kubernetes-workload-probe-readiness-grpc-service:
    description: 'Readiness probe gRPC service name'
    required: false
    default: ''
  kubernetes-workload-probe-readiness-initial-delay-seconds:
    description: 'Readiness probe initial delay in seconds'
    required: false
    default: '5'
  kubernetes-workload-probe-readiness-period-seconds:
    description: 'Readiness probe period in seconds'
    required: false
    default: '5'
  kubernetes-workload-probe-readiness-timeout-seconds:
    description: 'Readiness probe timeout in seconds'
    required: false
    default: '3'
  kubernetes-workload-probe-readiness-failure-threshold:
    description: 'Readiness probe failure threshold'
    required: false
    default: '3'
  kubernetes-workload-probe-readiness-success-threshold:
    description: 'Readiness probe success threshold'
    required: false
    default: '1'
  # Startup probe inputs
  kubernetes-workload-probe-startup-check-type:
    description: 'Startup probe type (http-get, tcp-socket, exec, grpc, none)'
    required: false
    default: 'http-get'
  kubernetes-workload-probe-startup-http-path:
    description: 'Startup probe HTTP path'
    required: false
    default: '/startup'
  kubernetes-workload-probe-startup-http-scheme:
    description: 'Startup probe HTTP scheme (HTTP, HTTPS)'
    required: false
    default: 'HTTP'
  kubernetes-workload-probe-startup-tcp-port:
    description: 'Startup probe TCP port (defaults to container port)'
    required: false
    default: ''
  kubernetes-workload-probe-startup-exec-command:
    description: 'Startup probe exec command'
    required: false
    default: ''
  kubernetes-workload-probe-startup-grpc-port:
    description: 'Startup probe gRPC port (defaults to container port)'
    required: false
    default: ''
  kubernetes-workload-probe-startup-grpc-service:
    description: 'Startup probe gRPC service name'
    required: false
    default: ''
  kubernetes-workload-probe-startup-initial-delay-seconds:
    description: 'Startup probe initial delay in seconds'
    required: false
    default: '0'
  kubernetes-workload-probe-startup-period-seconds:
    description: 'Startup probe period in seconds'
    required: false
    default: '5'
  kubernetes-workload-probe-startup-timeout-seconds:
    description: 'Startup probe timeout in seconds'
    required: false
    default: '3'
  kubernetes-workload-probe-startup-failure-threshold:
    description: 'Startup probe failure threshold'
    required: false
    default: '30'
  kubernetes-workload-probe-startup-termination-grace-period-seconds:
    description: 'Startup probe termination grace period (empty for default)'
    required: false
    default: ''
  # Deployment unique inputs
  kubernetes-deployment-env-sub-path:
    description: 'Path to deployment environment variables directory'
    required: false
    default: 'src/deployment-env'
  kubernetes-deployment-additional-labels:
    description: 'Additional labels for Deployment resources (key=value,key=value)'
    required: false
    default: ''
  kubernetes-deployment-additional-annotations:
    description: 'Additional annotations for Deployment resources (key=value,key=value)'
    required: false
    default: ''
  kubernetes-deployment-max-surge:
    description: 'Max surge during rolling update (integer or percentage, e.g., 1 or 25%)'
    required: false
    default: '1'
  kubernetes-deployment-max-unavailable:
    description: 'Max unavailable during rolling update (integer or percentage, e.g., 0 or 25%)'
    required: false
    default: '0'
  # StatefulSet unique inputs
  kubernetes-statefulset-env-sub-path:
    description: 'Path to statefulset environment variables directory'
    required: false
    default: 'src/statefulset-env'
  kubernetes-statefulset-additional-labels:
    description: 'Additional labels for StatefulSet resources (key=value,key=value)'
    required: false
    default: ''
  kubernetes-statefulset-additional-annotations:
    description: 'Additional annotations for StatefulSet resources (key=value,key=value)'
    required: false
    default: ''
  kubernetes-statefulset-service-name:
    description: 'Headless service name (empty for auto-derived from project name)'
    required: false
    default: ''
  kubernetes-statefulset-pod-management-policy:
    description: 'Pod management policy (OrderedReady or Parallel)'
    required: false
    default: 'OrderedReady'
  kubernetes-statefulset-allow-unreliable-pod-management-policy:
    description: 'Required acknowledgment to use Parallel pod management (must be I_LIKE_DOWNTIME)'
    required: false
    default: ''
  kubernetes-statefulset-update-strategy-type:
    description: 'Update strategy type (RollingUpdate or OnDelete)'
    required: false
    default: 'RollingUpdate'
  kubernetes-statefulset-update-strategy-partition:
    description: 'Partition for rolling updates (empty for none)'
    required: false
    default: ''
  kubernetes-statefulset-pvc-enabled:
    description: 'Enable persistent volume claim template (true/false)'
    required: false
    default: 'true'
  kubernetes-statefulset-pvc-storage-class:
    description: 'Storage class for PVC (empty for cluster default)'
    required: false
    default: ''
  kubernetes-statefulset-pvc-storage-size:
    description: 'Storage size for PVC (e.g., 1Gi, 10Gi)'
    required: false
    default: '1Gi'
  kubernetes-statefulset-pvc-access-mode:
    description: 'PVC access mode (ReadWriteOnce, ReadOnlyMany, ReadWriteMany)'
    required: false
    default: 'ReadWriteOnce'
  kubernetes-statefulset-pvc-volume-name:
    description: 'Volume name for the PVC template'
    required: false
    default: 'data'
  kubernetes-statefulset-pvc-mount-path:
    description: 'Mount path for the persistent volume'
    required: false
    default: '/data'
  # DaemonSet unique inputs
  kubernetes-daemonset-update-strategy-type:
    description: 'Update strategy type (RollingUpdate or OnDelete)'
    required: false
    default: 'RollingUpdate'
  kubernetes-daemonset-max-unavailable:
    description: 'Max unavailable pods during rolling update (number or percentage)'
    required: false
    default: '1'
  kubernetes-daemonset-min-ready-seconds:
    description: 'Minimum seconds a pod must be ready before considered available'
    required: false
    default: '0'
  kubernetes-daemonset-host-network:
    description: 'Use host network namespace (true/false)'
    required: false
    default: 'false'
  kubernetes-daemonset-host-pid:
    description: 'Use host PID namespace (true/false)'
    required: false
    default: 'false'
  kubernetes-daemonset-host-ipc:
    description: 'Use host IPC namespace (true/false)'
    required: false
    default: 'false'
  kubernetes-daemonset-run-as-non-root:
    description: 'Require non-root user (true/false, set false for system-level DaemonSets that need root)'
    required: false
    default: 'true'
  kubernetes-daemonset-privileged:
    description: 'Run container in privileged mode (true/false)'
    required: false
    default: 'false'
  kubernetes-daemonset-dns-policy:
    description: 'DNS policy (ClusterFirst, ClusterFirstWithHostNet, Default, None)'
    required: false
    default: ''
  kubernetes-daemonset-tolerations:
    description: 'Tolerations as JSON array (e.g., [{"operator":"Exists"}] or [{"key":"node-role.kubernetes.io/control-plane","operator":"Exists","effect":"NoSchedule"}])'
    required: false
    default: ''
  kubernetes-daemonset-node-selector:
    description: 'Node selector labels (comma-separated key=value)'
    required: false
    default: ''
  # Kubernetes Job generation inputs
  kubernetes-job-name-suffix:
    description: 'Optional suffix for Job name and filename'
    required: false
    default: ''
  kubernetes-job-combined-sub-path:
    description: 'Sub-path within combined/ for output'
    required: false
    default: ''
  kubernetes-job-backoff-limit:
    description: 'Number of retries before marking Job as failed'
    required: false
    default: '6'
  kubernetes-job-completions:
    description: 'Number of successful completions needed'
    required: false
    default: '1'
  kubernetes-job-parallelism:
    description: 'Number of pods running at any time'
    required: false
    default: '1'
  kubernetes-job-active-deadline-seconds:
    description: 'Maximum time in seconds the Job can run (optional)'
    required: false
    default: ''
  kubernetes-job-ttl-seconds-after-finished:
    description: 'Cleanup time after Job completion in seconds'
    required: false
    default: '86400'
  kubernetes-job-restart-policy:
    description: 'Pod restart policy (Never or OnFailure)'
    required: false
    default: 'Never'
  kubernetes-job-env-sub-path:
    description: 'Path to Job environment variables directory'
    required: false
    default: ''
  kubernetes-job-additional-labels:
    description: 'Additional labels for Job resources (key=value,key=value)'
    required: false
    default: ''
  kubernetes-job-additional-annotations:
    description: 'Additional annotations for Job resources (key=value,key=value)'
    required: false
    default: ''
  kubernetes-job-liveness-probe-enabled:
    description: 'Enable liveness probe (uses workload probe settings when true)'
    required: false
    default: 'false'
  kubernetes-job-readiness-probe-enabled:
    description: 'Enable readiness probe (uses workload probe settings when true)'
    required: false
    default: 'false'
  kubernetes-job-startup-probe-enabled:
    description: 'Enable startup probe (uses workload probe settings when true)'
    required: false
    default: 'false'
  # Kubernetes CronJob generation inputs
  kubernetes-cronjob-name-suffix:
    description: 'Optional suffix for CronJob name and filename'
    required: false
    default: ''
  kubernetes-cronjob-combined-sub-path:
    description: 'Sub-path within combined/ for output'
    required: false
    default: ''
  kubernetes-cronjob-concurrency-policy:
    description: 'How to handle concurrent job runs (Allow, Forbid, Replace)'
    required: false
    default: 'Forbid'
  kubernetes-cronjob-starting-deadline-seconds:
    description: 'Deadline for starting job if missed scheduled time (optional)'
    required: false
    default: ''
  kubernetes-cronjob-successful-jobs-history-limit:
    description: 'Number of successful jobs to retain for log collection'
    required: false
    default: '1'
  kubernetes-cronjob-failed-jobs-history-limit:
    description: 'Number of failed jobs to retain to show failure patterns'
    required: false
    default: '5'
  kubernetes-cronjob-backoff-limit:
    description: 'Number of retries before marking job as failed'
    required: false
    default: '6'
  kubernetes-cronjob-completions:
    description: 'Number of successful completions needed'
    required: false
    default: '1'
  kubernetes-cronjob-parallelism:
    description: 'Number of pods running at any time'
    required: false
    default: '1'
  kubernetes-cronjob-active-deadline-seconds:
    description: 'Maximum time in seconds the job can run (optional)'
    required: false
    default: ''
  kubernetes-cronjob-restart-policy:
    description: 'Pod restart policy (Never or OnFailure)'
    required: false
    default: 'Never'
  kubernetes-cronjob-env-sub-path:
    description: 'Path to CronJob environment variables directory'
    required: false
    default: ''
  kubernetes-cronjob-additional-labels:
    description: 'Additional labels for CronJob resources (key=value,key=value)'
    required: false
    default: ''
  kubernetes-cronjob-additional-annotations:
    description: 'Additional annotations for CronJob resources (key=value,key=value)'
    required: false
    default: ''
  kubernetes-cronjob-liveness-probe-enabled:
    description: 'Enable liveness probe (uses workload probe settings when true)'
    required: false
    default: 'false'
  kubernetes-cronjob-readiness-probe-enabled:
    description: 'Enable readiness probe (uses workload probe settings when true)'
    required: false
    default: 'false'
  kubernetes-cronjob-startup-probe-enabled:
    description: 'Enable startup probe (uses workload probe settings when true)'
    required: false
    default: 'false'
  # Kubernetes Service generation
  kubernetes-service-generation-enabled:
    description: 'Enable Service generation (true, false, or empty for auto based on workload type)'
    required: false
  kubernetes-service-type:
    description: 'Service type (ClusterIP, Headless, NoSelector, NodePort, LoadBalancer, ExternalName)'
    required: false
    default: 'ClusterIP'
  kubernetes-service-port:
    description: 'Service port (not used for ExternalName)'
    required: false
    default: '80'
  kubernetes-service-target-port:
    description: 'Target port (defaults to container port, not used for ExternalName)'
    required: false
    default: ''
  kubernetes-service-protocol:
    description: 'Protocol (TCP, UDP, SCTP)'
    required: false
    default: 'TCP'
  kubernetes-service-port-name:
    description: 'Named port identifier (optional)'
    required: false
    default: ''
  kubernetes-service-node-port:
    description: 'Node port number (NodePort type only, empty for auto-assign)'
    required: false
    default: ''
  kubernetes-service-external-name:
    description: 'External DNS name (required for ExternalName type)'
    required: false
    default: ''
  kubernetes-service-external-traffic-policy:
    description: 'External traffic policy (Cluster or Local, NodePort/LoadBalancer only)'
    required: false
    default: ''
  kubernetes-service-name-suffix:
    description: 'Optional suffix for Service name and filename'
    required: false
    default: ''
  kubernetes-service-combined-sub-path:
    description: 'Sub-path within combined/ for output'
    required: false
    default: ''
  kubernetes-service-additional-labels:
    description: 'Additional labels specific to Service (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-service-additional-annotations:
    description: 'Additional annotations specific to Service (comma-separated key=value)'
    required: false
    default: ''
  # Token substitution
  token-delimiter-style:
    description: 'Token delimiter syntax for variables (shell, mustache, helm, erb, github-actions, blade, stringtemplate, ognl, t4, swift)'
    required: false
    default: 'shell'
  token-name-style:
    description: 'Case style for token names (UPPER_SNAKE, lower_snake, lower-kebab, UPPER-KEBAB, camelCase, PascalCase, lower.dot, UPPER.DOT)'
    required: false
    default: 'PascalCase'
  token-name-validation:
    description: 'How to validate user token names (MATCH = must match token-name-style, ALL = accept any valid name)'
    required: false
    default: 'MATCH'
  allow-builtin-token-override:
    description: 'Allow user tokens to override built-in tokens (for template/reusable projects)'
    required: false
    default: 'false'
  config-sub-path:
    description: 'Directory containing user-defined token files (relative)'
    required: false
    default: 'src/config'
  config-value-trailing-newline:
    description: 'How to handle trailing newlines in config values (strip-for-single-line, preserve-all, always-strip-one-newline)'
    required: false
    default: 'strip-for-single-line'
  # Release branches
  release-branch:
    description: 'The release branch name'
    required: false
    default: 'main'
  additional-release-branches:
    description: 'Comma-separated list of additional release branches'
    required: false
    default: ''
  # Tag version calculation
  tag-version-max-parts:
    description: 'Maximum allowed version parts (fail if exceeded)'
    required: false
    default: '3'
  tag-version-calculation-strategy:
    description: 'Strategy for calculating version (git-auto-closest-highest, file-pattern-match)'
    required: false
    default: 'git-auto-closest-highest'
  tag-version-pattern-type:
    description: 'Pattern type for file-pattern-match strategy (dockerfile-env-kubectl, retag-workflow-source-tag, custom)'
    required: false
    default: 'dockerfile-env-kubectl'
  tag-version-prefix-parts:
    description: 'Number of parts from source version to use as prefix (default 2, output = prefix + 1 parts)'
    required: false
    default: ''
  tag-version-source-sub-path:
    description: 'Override path to source directory (takes precedence over dockerfile-sub-path)'
    required: false
    default: ''
  tag-version-source-file-name:
    description: 'Override source file name (defaults based on pattern type)'
    required: false
    default: ''
  tag-version-source-custom-pattern:
    description: 'Regex with capture group for version extraction (required for custom pattern type)'
    required: false
    default: ''
  # Basic quality checks
  block-slashes:
    description: 'DEPRECATED: Use block-slash-containing-branches instead'
    required: false
    default: 'false'
  qc-block-slash-containing-branches:
    description: 'Block branch names containing slashes'
    required: false
    default: 'false'
  qc-block-double-hyphen-containing-branches:
    description: 'Block branch names containing double hyphens (typo detection)'
    required: false
    default: 'true'
  qc-require-conventional-branches:
    description: 'Require branch names start with feature/, fix/, etc.'
    required: false
    default: 'false'
  qc-require-conventional-commits:
    description: 'Require commits use conventional commit format (feat:, fix:, etc.)'
    required: false
    default: 'false'
  qc-block-conventional-commits:
    description: 'Block commits that use conventional commit format'
    required: false
    default: 'false'
  # Pre tagging hook script path
  hook-pre-tagging-tests-script-sub-path:
    description: 'Path to pre-tagging test script relative to .github/ (e.g., bin/pre-tagging.bash)'
    required: false
    default: ''
  # Docker related hook script paths
  hook-pre-docker-prepare-script-sub-path:
    description: 'Path to pre-docker prepare script relative to .github/ (e.g., bin/pre-docker-prepare.bash)'
    required: false
    default: ''
  hook-post-docker-tests-script-sub-path:
    description: 'Path to post-docker test script relative to .github/ (e.g., bin/post-docker.bash)'
    required: false
    default: ''
  # Manifest package hook script paths
  hook-pre-package-prepare-script-sub-path:
    description: 'Path to pre-package prepare script relative to .github/ (e.g., bin/pre-package-prepare.bash)'
    required: false
    default: ''
  hook-post-package-tests-script-sub-path:
    description: 'Path to post-package test script relative to .github/ (e.g., bin/post-package.bash)'
    required: false
    default: ''
  # GitHub release
  github-release-enabled:
    description: 'Create a GitHub release on version tags'
    required: false
    default: 'true'
  github-release-substituted-files:
    description: 'Files with token substitution and version suffix (space-separated)'
    required: false
    default: ''
  github-release-verbatim-files:
    description: 'Files copied as-is with version suffix only (space-separated)'
    required: false
    default: ''
  github-release-notes:
    description: 'Release notes (leave empty for auto-generated)'
    required: false
    default: ''
  github-release-add-version-to-filenames:
    description: 'Add version suffix to release filenames (e.g., file.yaml -> file-1.2.3.yaml)'
    required: false
    default: 'true'

  # === Step Outputs ===
  # Version outputs (from versions-and-naming)
  version:
    description: 'Version string'
    required: true
  version-major:
    description: 'Major version number'
    required: true
  version-minor:
    description: 'Minor version number'
    required: true
  version-patch:
    description: 'Patch version number'
    required: true
  version-2-part:
    description: 'Version padded/truncated to 2 parts'
    required: true
  version-3-part:
    description: 'Version padded/truncated to 3 parts'
    required: true
  version-4-part:
    description: 'Version padded/truncated to 4 parts'
    required: true
  docker-tag:
    description: 'Docker tag'
    required: true
  docker-image-name:
    description: 'Docker image name'
    required: true
  git-tag:
    description: 'Git tag'
    required: true
  project-name:
    description: 'Project name'
    required: true
  is-release:
    description: 'Whether this is a release build'
    required: true
  # Docker outputs (from docker-build)
  docker-substituted-sub-path:
    description: 'Docker substituted files directory - empty in manifests-only workflows'
    required: false
    default: ''
  target-image-full-uri:
    description: 'Full target image URI (registry/name:tag) - empty in manifests-only workflows'
    required: false
    default: ''
  # Manifest outputs (from manifest-package)
  manifests-substituted-sub-path:
    description: 'Manifests substituted directory (for inspection)'
    required: true
  manifests-zip-sub-path:
    description: 'Directory containing the zip file'
    required: true
  manifests-zip-file-name:
    description: 'Name of the zip file'
    required: true
  # Manifest repo provider outputs (from manifest-repo-provider-package)
  manifests-uri:
    description: 'URI for packaged manifests (e.g., OCI image reference) - empty in manifests-only workflows'
    required: false
    default: ''

runs:
  using: composite
  steps:
    - name: Run post-package tests hook
      shell: bash
      env:
        HOOK_SCRIPT_SUB_PATH: .github/${{ inputs.script-sub-path }}
        # Workflow inputs - build output
        OUTPUT_SUB_PATH: ${{ inputs.output-sub-path }}

        # Workflow inputs - docker registry logins
        DOCKER_REGISTRY_LOGINS: ${{ inputs.docker-registry-logins }}
        # Workflow inputs - docker build options
        DOCKERFILE_SUB_PATH: ${{ inputs.dockerfile-sub-path }}
        DOCKERFILE_SQUASH: ${{ inputs.dockerfile-squash }}
        DOCKERFILE_NO_CACHE: ${{ inputs.dockerfile-no-cache }}
        # Workflow inputs - docker target config
        DOCKER_TARGET_REGISTRY: ${{ inputs.docker-target-registry }}
        DOCKER_TARGET_BASE_PATH: ${{ inputs.docker-target-base-path }}
        # Workflow inputs - docker push targets
        DOCKER_PUSH_TARGETS: ${{ inputs.docker-push-targets }}

        # Workflow inputs - manifests source
        MANIFESTS_SUB_PATH: ${{ inputs.manifests-sub-path }}
        # Workflow inputs - manifests packaging
        MANIFESTS_REPO_PROVIDER_TYPE: ${{ inputs.manifests-repo-provider-type }}
        MANIFESTS_PACKAGING_BASE_IMAGE: ${{ inputs.manifests-packaging-base-image }}

        # Workflow inputs - kubernetes generation
        KUBERNETES_GLOBAL_ADDITIONAL_LABELS: ${{ inputs.kubernetes-global-additional-labels }}
        KUBERNETES_GLOBAL_ADDITIONAL_ANNOTATIONS: ${{ inputs.kubernetes-global-additional-annotations }}
        # Workflow inputs - kubernetes configmap generation
        KUBERNETES_CONFIGMAP_SUB_PATH: ${{ inputs.kubernetes-configmap-sub-path }}
        KUBERNETES_CONFIGMAP_NAME_CHECKSUM_INJECTION: ${{ inputs.kubernetes-configmap-name-checksum-injection }}
        KUBERNETES_CONFIGMAP_ADDITIONAL_LABELS: ${{ inputs.kubernetes-configmap-additional-labels }}
        KUBERNETES_CONFIGMAP_ADDITIONAL_ANNOTATIONS: ${{ inputs.kubernetes-configmap-additional-annotations }}
        # Workflow inputs - kubernetes secret template generation
        KUBERNETES_SECRET_TEMPLATE_SUB_PATH: ${{ inputs.kubernetes-secret-template-sub-path }}
        KUBERNETES_SECRET_TEMPLATE_NAME_CHECKSUM_INJECTION: ${{ inputs.kubernetes-secret-template-name-checksum-injection }}
        KUBERNETES_SECRET_TEMPLATE_ADDITIONAL_LABELS: ${{ inputs.kubernetes-secret-template-additional-labels }}
        KUBERNETES_SECRET_TEMPLATE_ADDITIONAL_ANNOTATIONS: ${{ inputs.kubernetes-secret-template-additional-annotations }}
        # Workflow inputs - kubernetes serviceaccount generation
        KUBERNETES_SERVICEACCOUNT_GENERATION_ENABLED: ${{ inputs.kubernetes-serviceaccount-generation-enabled }}
        KUBERNETES_SERVICEACCOUNT_NAME_SUFFIX: ${{ inputs.kubernetes-serviceaccount-name-suffix }}
        KUBERNETES_SERVICEACCOUNT_COMBINED_SUB_PATH: ${{ inputs.kubernetes-serviceaccount-combined-sub-path }}
        KUBERNETES_SERVICEACCOUNT_ADDITIONAL_LABELS: ${{ inputs.kubernetes-serviceaccount-additional-labels }}
        KUBERNETES_SERVICEACCOUNT_ADDITIONAL_ANNOTATIONS: ${{ inputs.kubernetes-serviceaccount-additional-annotations }}
        # Workflow inputs - kubernetes workload generation
        KUBERNETES_WORKLOAD_TYPE: ${{ inputs.kubernetes-workload-type }}
        KUBERNETES_WORKLOAD_NAME_SUFFIX: ${{ inputs.kubernetes-workload-name-suffix }}
        KUBERNETES_WORKLOAD_COMBINED_SUB_PATH: ${{ inputs.kubernetes-workload-combined-sub-path }}
        KUBERNETES_WORKLOAD_ENV_SUB_PATH: ${{ inputs.kubernetes-workload-env-sub-path }}
        KUBERNETES_WORKLOAD_ADDITIONAL_LABELS: ${{ inputs.kubernetes-workload-additional-labels }}
        KUBERNETES_WORKLOAD_ADDITIONAL_ANNOTATIONS: ${{ inputs.kubernetes-workload-additional-annotations }}
        KUBERNETES_WORKLOAD_CONTAINER_PORT: ${{ inputs.kubernetes-workload-container-port }}
        KUBERNETES_WORKLOAD_IMAGE_REFERENCE_STYLE: ${{ inputs.kubernetes-workload-image-reference-style }}
        KUBERNETES_WORKLOAD_READONLY_ROOT_FILESYSTEM: ${{ inputs.kubernetes-workload-readonly-root-filesystem }}
        KUBERNETES_WORKLOAD_SECCOMP_PROFILE: ${{ inputs.kubernetes-workload-seccomp-profile }}
        KUBERNETES_WORKLOAD_AUTOMOUNT_SERVICE_ACCOUNT_TOKEN: ${{ inputs.kubernetes-workload-automount-service-account-token }}
        KUBERNETES_WORKLOAD_IMAGE_PULL_SECRETS: ${{ inputs.kubernetes-workload-image-pull-secrets }}
        KUBERNETES_WORKLOAD_RESOURCES_MEMORY: ${{ inputs.kubernetes-workload-resources-memory }}
        KUBERNETES_WORKLOAD_RESOURCES_CPU_REQUEST: ${{ inputs.kubernetes-workload-resources-cpu-request }}
        KUBERNETES_WORKLOAD_RESOURCES_CPU_LIMIT: ${{ inputs.kubernetes-workload-resources-cpu-limit }}
        KUBERNETES_WORKLOAD_CONFIGMAP_MOUNT_PATH: ${{ inputs.kubernetes-workload-configmap-mount-path }}
        KUBERNETES_WORKLOAD_SECRET_MOUNT_PATH: ${{ inputs.kubernetes-workload-secret-mount-path }}
        KUBERNETES_WORKLOAD_TERMINATION_GRACE_PERIOD_SECONDS: ${{ inputs.kubernetes-workload-termination-grace-period-seconds }}
        KUBERNETES_WORKLOAD_PRESTOP_COMMAND: ${{ inputs.kubernetes-workload-prestop-command }}
        KUBERNETES_WORKLOAD_AFFINITY_STRATEGY: ${{ inputs.kubernetes-workload-affinity-strategy }}
        KUBERNETES_WORKLOAD_TOLERATIONS: ${{ inputs.kubernetes-workload-tolerations }}
        KUBERNETES_WORKLOAD_NODE_SELECTOR: ${{ inputs.kubernetes-workload-node-selector }}
        KUBERNETES_WORKLOAD_DNS_POLICY: ${{ inputs.kubernetes-workload-dns-policy }}
        KUBERNETES_WORKLOAD_CONTAINER_COMMAND: ${{ inputs.kubernetes-workload-container-command }}
        KUBERNETES_WORKLOAD_CONTAINER_ARGS: ${{ inputs.kubernetes-workload-container-args }}
        KUBERNETES_WORKLOAD_PROBE_LIVENESS_CHECK_TYPE: ${{ inputs.kubernetes-workload-probe-liveness-check-type }}
        KUBERNETES_WORKLOAD_PROBE_READINESS_CHECK_TYPE: ${{ inputs.kubernetes-workload-probe-readiness-check-type }}
        KUBERNETES_WORKLOAD_PROBE_STARTUP_CHECK_TYPE: ${{ inputs.kubernetes-workload-probe-startup-check-type }}
        KUBERNETES_WORKLOAD_PROBE_LIVENESS_HTTP_PATH: ${{ inputs.kubernetes-workload-probe-liveness-http-path }}
        KUBERNETES_WORKLOAD_PROBE_READINESS_HTTP_PATH: ${{ inputs.kubernetes-workload-probe-readiness-http-path }}
        KUBERNETES_WORKLOAD_PROBE_STARTUP_HTTP_PATH: ${{ inputs.kubernetes-workload-probe-startup-http-path }}
        KUBERNETES_WORKLOAD_REPLICAS: ${{ inputs.kubernetes-workload-replicas }}
        KUBERNETES_WORKLOAD_REVISION_HISTORY_LIMIT: ${{ inputs.kubernetes-workload-revision-history-limit }}
        # Workflow inputs - deployment unique
        KUBERNETES_DEPLOYMENT_ENV_SUB_PATH: ${{ inputs.kubernetes-deployment-env-sub-path }}
        KUBERNETES_DEPLOYMENT_ADDITIONAL_LABELS: ${{ inputs.kubernetes-deployment-additional-labels }}
        KUBERNETES_DEPLOYMENT_ADDITIONAL_ANNOTATIONS: ${{ inputs.kubernetes-deployment-additional-annotations }}
        KUBERNETES_DEPLOYMENT_MAX_SURGE: ${{ inputs.kubernetes-deployment-max-surge }}
        KUBERNETES_DEPLOYMENT_MAX_UNAVAILABLE: ${{ inputs.kubernetes-deployment-max-unavailable }}
        # Workflow inputs - statefulset unique
        KUBERNETES_STATEFULSET_SERVICE_NAME: ${{ inputs.kubernetes-statefulset-service-name }}
        KUBERNETES_STATEFULSET_POD_MANAGEMENT_POLICY: ${{ inputs.kubernetes-statefulset-pod-management-policy }}
        KUBERNETES_STATEFULSET_ALLOW_UNRELIABLE_POD_MANAGEMENT_POLICY: ${{ inputs.kubernetes-statefulset-allow-unreliable-pod-management-policy }}
        KUBERNETES_STATEFULSET_UPDATE_STRATEGY_TYPE: ${{ inputs.kubernetes-statefulset-update-strategy-type }}
        KUBERNETES_STATEFULSET_UPDATE_STRATEGY_PARTITION: ${{ inputs.kubernetes-statefulset-update-strategy-partition }}
        KUBERNETES_STATEFULSET_PVC_ENABLED: ${{ inputs.kubernetes-statefulset-pvc-enabled }}
        KUBERNETES_STATEFULSET_PVC_STORAGE_CLASS: ${{ inputs.kubernetes-statefulset-pvc-storage-class }}
        KUBERNETES_STATEFULSET_PVC_STORAGE_SIZE: ${{ inputs.kubernetes-statefulset-pvc-storage-size }}
        KUBERNETES_STATEFULSET_PVC_ACCESS_MODE: ${{ inputs.kubernetes-statefulset-pvc-access-mode }}
        KUBERNETES_STATEFULSET_PVC_VOLUME_NAME: ${{ inputs.kubernetes-statefulset-pvc-volume-name }}
        KUBERNETES_STATEFULSET_PVC_MOUNT_PATH: ${{ inputs.kubernetes-statefulset-pvc-mount-path }}
        # Workflow inputs - kubernetes service generation
        KUBERNETES_SERVICE_GENERATION_ENABLED: ${{ inputs.kubernetes-service-generation-enabled }}
        KUBERNETES_SERVICE_TYPE: ${{ inputs.kubernetes-service-type }}
        KUBERNETES_SERVICE_PORT: ${{ inputs.kubernetes-service-port }}
        KUBERNETES_SERVICE_TARGET_PORT: ${{ inputs.kubernetes-service-target-port }}
        KUBERNETES_SERVICE_PROTOCOL: ${{ inputs.kubernetes-service-protocol }}
        KUBERNETES_SERVICE_PORT_NAME: ${{ inputs.kubernetes-service-port-name }}
        KUBERNETES_SERVICE_NODE_PORT: ${{ inputs.kubernetes-service-node-port }}
        KUBERNETES_SERVICE_EXTERNAL_NAME: ${{ inputs.kubernetes-service-external-name }}
        KUBERNETES_SERVICE_EXTERNAL_TRAFFIC_POLICY: ${{ inputs.kubernetes-service-external-traffic-policy }}
        KUBERNETES_SERVICE_NAME_SUFFIX: ${{ inputs.kubernetes-service-name-suffix }}
        KUBERNETES_SERVICE_COMBINED_SUB_PATH: ${{ inputs.kubernetes-service-combined-sub-path }}
        KUBERNETES_SERVICE_ADDITIONAL_LABELS: ${{ inputs.kubernetes-service-additional-labels }}
        KUBERNETES_SERVICE_ADDITIONAL_ANNOTATIONS: ${{ inputs.kubernetes-service-additional-annotations }}

        # Workflow inputs - token substitution
        TOKEN_DELIMITER_STYLE: ${{ inputs.token-delimiter-style }}
        TOKEN_NAME_STYLE: ${{ inputs.token-name-style }}
        TOKEN_NAME_VALIDATION: ${{ inputs.token-name-validation }}
        ALLOW_BUILTIN_TOKEN_OVERRIDE: ${{ inputs.allow-builtin-token-override }}
        CONFIG_SUB_PATH: ${{ inputs.config-sub-path }}
        CONFIG_VALUE_TRAILING_NEWLINE: ${{ inputs.config-value-trailing-newline }}

        # Workflow inputs - naming, versions, and tags calculation
        RELEASE_BRANCH: ${{ inputs.release-branch }}
        ADDITIONAL_RELEASE_BRANCHES: ${{ inputs.additional-release-branches }}
        TAG_VERSION_MAX_PARTS: ${{ inputs.tag-version-max-parts }}
        TAG_VERSION_CALCULATION_STRATEGY: ${{ inputs.tag-version-calculation-strategy }}
        TAG_VERSION_PATTERN_TYPE: ${{ inputs.tag-version-pattern-type }}
        TAG_VERSION_PREFIX_PARTS: ${{ inputs.tag-version-prefix-parts }}
        TAG_VERSION_SOURCE_SUB_PATH: ${{ inputs.tag-version-source-sub-path }}
        TAG_VERSION_SOURCE_FILE_NAME: ${{ inputs.tag-version-source-file-name }}
        TAG_VERSION_SOURCE_CUSTOM_PATTERN: ${{ inputs.tag-version-source-custom-pattern }}

        # Workflow inputs - quality check options
        BLOCK_SLASHES: ${{ inputs.block-slashes }}
        QC_BLOCK_SLASH_CONTAINING_BRANCHES: ${{ inputs.qc-block-slash-containing-branches }}
        QC_BLOCK_DOUBLE_HYPHEN_CONTAINING_BRANCHES: ${{ inputs.qc-block-double-hyphen-containing-branches }}
        QC_REQUIRE_CONVENTIONAL_BRANCHES: ${{ inputs.qc-require-conventional-branches }}
        QC_REQUIRE_CONVENTIONAL_COMMITS: ${{ inputs.qc-require-conventional-commits }}
        QC_BLOCK_CONVENTIONAL_COMMITS: ${{ inputs.qc-block-conventional-commits }}

        # Workflow inputs - hook script paths
        HOOK_PRE_TAGGING_TESTS_SCRIPT_SUB_PATH: ${{ inputs.hook-pre-tagging-tests-script-sub-path }}
        HOOK_PRE_DOCKER_PREPARE_SCRIPT_SUB_PATH: ${{ inputs.hook-pre-docker-prepare-script-sub-path }}
        HOOK_POST_DOCKER_TESTS_SCRIPT_SUB_PATH: ${{ inputs.hook-post-docker-tests-script-sub-path }}
        HOOK_PRE_PACKAGE_PREPARE_SCRIPT_SUB_PATH: ${{ inputs.hook-pre-package-prepare-script-sub-path }}
        HOOK_POST_PACKAGE_TESTS_SCRIPT_SUB_PATH: ${{ inputs.hook-post-package-tests-script-sub-path }}

        # Workflow inputs - github release
        GITHUB_RELEASE_ENABLED: ${{ inputs.github-release-enabled }}
        GITHUB_RELEASE_SUBSTITUTED_FILES: ${{ inputs.github-release-substituted-files }}
        GITHUB_RELEASE_VERBATIM_FILES: ${{ inputs.github-release-verbatim-files }}
        GITHUB_RELEASE_NOTES: ${{ inputs.github-release-notes }}
        GITHUB_RELEASE_ADD_VERSION_TO_FILENAMES: ${{ inputs.github-release-add-version-to-filenames }}

        # Step outputs - version outputs
        VERSION: ${{ inputs.version }}
        VERSION_MAJOR: ${{ inputs.version-major }}
        VERSION_MINOR: ${{ inputs.version-minor }}
        VERSION_PATCH: ${{ inputs.version-patch }}
        VERSION_2_PART: ${{ inputs.version-2-part }}
        VERSION_3_PART: ${{ inputs.version-3-part }}
        VERSION_4_PART: ${{ inputs.version-4-part }}
        DOCKER_TAG: ${{ inputs.docker-tag }}
        DOCKER_IMAGE_NAME: ${{ inputs.docker-image-name }}
        GIT_TAG: ${{ inputs.git-tag }}
        PROJECT_NAME: ${{ inputs.project-name }}
        IS_RELEASE: ${{ inputs.is-release }}
        # Step outputs - docker outputs
        DOCKER_SUBSTITUTED_SUB_PATH: ${{ inputs.docker-substituted-sub-path }}
        TARGET_IMAGE_FULL_URI: ${{ inputs.target-image-full-uri }}
        # Step outputs - manifest outputs
        MANIFESTS_SUBSTITUTED_SUB_PATH: ${{ inputs.manifests-substituted-sub-path }}
        MANIFESTS_ZIP_SUB_PATH: ${{ inputs.manifests-zip-sub-path }}
        MANIFESTS_ZIP_FILE_NAME: ${{ inputs.manifests-zip-file-name }}
        # Step outputs - manifest repo provider outputs
        MANIFESTS_URI: ${{ inputs.manifests-uri }}
      run: .github/buildon-github-actions/src/scripts/main/hook-post-package-tests
