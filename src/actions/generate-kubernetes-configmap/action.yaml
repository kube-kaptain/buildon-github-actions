# SPDX-License-Identifier: MIT
# Copyright (c) 2025-2026 Kaptain contributors (Fred Cooke)

name: 'Generate Kubernetes ConfigMap'
description: 'Generates a Kubernetes ConfigMap manifest from files in a directory'

inputs:
  kubernetes-configmap-sub-path:
    description: 'Directory containing ConfigMap data files (relative)'
    required: false
    default: 'src/configmap'
  output-sub-path:
    description: 'Build output directory (relative)'
    required: false
    default: 'target'
  token-name-style:
    description: 'Case style for token names (UPPER_SNAKE, lower_snake, lower-kebab, UPPER-KEBAB, camelCase, PascalCase, lower.dot, UPPER.DOT)'
    required: false
    default: 'PascalCase'
  token-delimiter-style:
    description: 'Token delimiter syntax for variables (shell, mustache, helm, erb, github-actions, blade, stringtemplate, ognl, t4, swift)'
    required: false
    default: 'shell'
  kubernetes-configmap-name-checksum-injection:
    description: 'Enable checksum injection suffix in ConfigMap name (true: ProjectName-configmap-checksum, false: ProjectName)'
    required: false
    default: 'true'
  kubernetes-global-additional-labels:
    description: 'Additional labels for all Kubernetes manifests (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-global-additional-annotations:
    description: 'Additional annotations for all Kubernetes manifests (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-configmap-additional-labels:
    description: 'Additional labels specific to ConfigMap (comma-separated key=value)'
    required: false
    default: ''
  kubernetes-configmap-additional-annotations:
    description: 'Additional annotations specific to ConfigMap (comma-separated key=value)'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: Generate ConfigMap manifest
      id: generate
      shell: bash
      env:
        LOG_ERROR_PREFIX: '::error::'
        KUBERNETES_CONFIGMAP_SUB_PATH: ${{ inputs.kubernetes-configmap-sub-path }}
        OUTPUT_SUB_PATH: ${{ inputs.output-sub-path }}
        TOKEN_NAME_STYLE: ${{ inputs.token-name-style }}
        TOKEN_DELIMITER_STYLE: ${{ inputs.token-delimiter-style }}
        KUBERNETES_CONFIGMAP_NAME_CHECKSUM_INJECTION: ${{ inputs.kubernetes-configmap-name-checksum-injection }}
        KUBERNETES_GLOBAL_ADDITIONAL_LABELS: ${{ inputs.kubernetes-global-additional-labels }}
        KUBERNETES_GLOBAL_ADDITIONAL_ANNOTATIONS: ${{ inputs.kubernetes-global-additional-annotations }}
        KUBERNETES_CONFIGMAP_ADDITIONAL_LABELS: ${{ inputs.kubernetes-configmap-additional-labels }}
        KUBERNETES_CONFIGMAP_ADDITIONAL_ANNOTATIONS: ${{ inputs.kubernetes-configmap-additional-annotations }}
      run: "${{ github.action_path }}/../../scripts/generators/generate-kubernetes-configmap"
