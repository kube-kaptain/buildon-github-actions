# SPDX-License-Identifier: MIT
# Copyright (c) 2025-2026 Kaptain contributors (Fred Cooke)

- name: Compute release notes
  id: release-notes
  if: inputs.github-release-enabled == true && steps.versions.outputs.is-release == 'true'
  shell: bash
  env:
    USER_NOTES: ${{ inputs.github-release-notes }}
    VERSION: ${{ steps.versions.outputs.version }}
    PROJECT_NAME: ${{ steps.versions.outputs.project-name }}
    DOCKER_URI: ${{ steps.docker-build.outputs.docker-target-image-full-uri }}
  run: |
    if [[ -n "${USER_NOTES}" ]]; then
      # User provided notes override entirely
      {
        echo "notes<<NOTES_EOF"
        echo "${USER_NOTES}"
        echo "NOTES_EOF"
      } >> "${GITHUB_OUTPUT}"
    else
      # Default format
      {
        echo "notes<<NOTES_EOF"
        echo "Automatic Docker release for version ${VERSION} of ${PROJECT_NAME} by Kaptain build script."
        echo ""
        echo "### Release Assets"
        echo "* Docker Image: [${DOCKER_URI}](https://${DOCKER_URI})"
        echo "NOTES_EOF"
      } >> "${GITHUB_OUTPUT}"
    fi

- name: GitHub Release
  if: inputs.github-release-enabled == true && steps.versions.outputs.is-release == 'true'
  uses: ./.github/buildon-github-actions/src/actions/github-release
  with:
    github-release-enabled: ${{ inputs.github-release-enabled }}
    github-release-files: ${{ inputs.github-release-files }}
    github-release-tag: ${{ steps.versions.outputs.version }}
    github-release-notes: ${{ steps.release-notes.outputs.notes }}
