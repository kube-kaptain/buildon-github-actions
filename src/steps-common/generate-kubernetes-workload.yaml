# SPDX-License-Identifier: MIT
# Copyright (c) 2025-2026 Kaptain contributors (Fred Cooke)

- name: Generate workload manifest
  id: generate-workload
  if: inputs.kubernetes-workload-type != 'none'
  uses: ./.github/buildon-github-actions/src/actions/generate-kubernetes-workload
  with:
    # Required context
    project-name: ${{ steps.versions.outputs.project-name }}
    # Workload type
    kubernetes-workload-type: ${{ inputs.kubernetes-workload-type }}
    # Common workload settings
    kubernetes-workload-replicas: ${{ inputs.kubernetes-workload-replicas }}
    kubernetes-workload-revision-history-limit: ${{ inputs.kubernetes-workload-revision-history-limit }}
    kubernetes-workload-min-ready-seconds: ${{ inputs.kubernetes-workload-min-ready-seconds }}
    kubernetes-workload-name-suffix: ${{ inputs.kubernetes-workload-name-suffix }}
    kubernetes-workload-combined-sub-path: ${{ inputs.kubernetes-workload-combined-sub-path }}
    kubernetes-workload-env-sub-path: ${{ inputs.kubernetes-workload-env-sub-path }}
    kubernetes-workload-additional-labels: ${{ inputs.kubernetes-workload-additional-labels }}
    kubernetes-workload-additional-annotations: ${{ inputs.kubernetes-workload-additional-annotations }}
    # Container configuration
    kubernetes-workload-container-port: ${{ inputs.kubernetes-workload-container-port }}
    kubernetes-workload-image-reference-style: ${{ inputs.kubernetes-workload-image-reference-style }}
    # Security settings
    kubernetes-workload-readonly-root-filesystem: ${{ inputs.kubernetes-workload-readonly-root-filesystem }}
    kubernetes-workload-seccomp-profile: ${{ inputs.kubernetes-workload-seccomp-profile }}
    kubernetes-workload-automount-service-account-token: ${{ inputs.kubernetes-workload-automount-service-account-token }}
    kubernetes-workload-image-pull-secrets: ${{ inputs.kubernetes-workload-image-pull-secrets }}
    # Resource limits
    kubernetes-workload-resources-memory: ${{ inputs.kubernetes-workload-resources-memory }}
    kubernetes-workload-resources-cpu-request: ${{ inputs.kubernetes-workload-resources-cpu-request }}
    kubernetes-workload-resources-cpu-limit: ${{ inputs.kubernetes-workload-resources-cpu-limit }}
    kubernetes-workload-resources-ephemeral-storage: ${{ inputs.kubernetes-workload-resources-ephemeral-storage }}
    # Mount paths
    kubernetes-workload-configmap-mount-path: ${{ inputs.kubernetes-workload-configmap-mount-path }}
    kubernetes-workload-secret-mount-path: ${{ inputs.kubernetes-workload-secret-mount-path }}
    # Environment variable refs from ConfigMap/Secret keys
    kubernetes-workload-configmap-keys-for-env: ${{ inputs.kubernetes-workload-configmap-keys-for-env }}
    kubernetes-workload-secret-keys-for-env: ${{ inputs.kubernetes-workload-secret-keys-for-env }}
    # Lifecycle
    kubernetes-workload-termination-grace-period-seconds: ${{ inputs.kubernetes-workload-termination-grace-period-seconds }}
    kubernetes-workload-prestop-command: ${{ inputs.kubernetes-workload-prestop-command }}
    kubernetes-workload-affinity-strategy: ${{ inputs.kubernetes-workload-affinity-strategy }}
    kubernetes-workload-tolerations: ${{ inputs.kubernetes-workload-tolerations }}
    kubernetes-workload-priority-class-name: ${{ inputs.kubernetes-workload-priority-class-name }}
    # Liveness probe settings
    kubernetes-workload-probe-liveness-check-type: ${{ inputs.kubernetes-workload-probe-liveness-check-type }}
    kubernetes-workload-probe-liveness-http-path: ${{ inputs.kubernetes-workload-probe-liveness-http-path }}
    kubernetes-workload-probe-liveness-http-scheme: ${{ inputs.kubernetes-workload-probe-liveness-http-scheme }}
    kubernetes-workload-probe-liveness-tcp-port: ${{ inputs.kubernetes-workload-probe-liveness-tcp-port }}
    kubernetes-workload-probe-liveness-exec-command: ${{ inputs.kubernetes-workload-probe-liveness-exec-command }}
    kubernetes-workload-probe-liveness-grpc-port: ${{ inputs.kubernetes-workload-probe-liveness-grpc-port }}
    kubernetes-workload-probe-liveness-grpc-service: ${{ inputs.kubernetes-workload-probe-liveness-grpc-service }}
    kubernetes-workload-probe-liveness-initial-delay-seconds: ${{ inputs.kubernetes-workload-probe-liveness-initial-delay-seconds }}
    kubernetes-workload-probe-liveness-period-seconds: ${{ inputs.kubernetes-workload-probe-liveness-period-seconds }}
    kubernetes-workload-probe-liveness-timeout-seconds: ${{ inputs.kubernetes-workload-probe-liveness-timeout-seconds }}
    kubernetes-workload-probe-liveness-failure-threshold: ${{ inputs.kubernetes-workload-probe-liveness-failure-threshold }}
    kubernetes-workload-probe-liveness-termination-grace-period-seconds: ${{ inputs.kubernetes-workload-probe-liveness-termination-grace-period-seconds }}
    # Readiness probe settings
    kubernetes-workload-probe-readiness-check-type: ${{ inputs.kubernetes-workload-probe-readiness-check-type }}
    kubernetes-workload-probe-readiness-http-path: ${{ inputs.kubernetes-workload-probe-readiness-http-path }}
    kubernetes-workload-probe-readiness-http-scheme: ${{ inputs.kubernetes-workload-probe-readiness-http-scheme }}
    kubernetes-workload-probe-readiness-tcp-port: ${{ inputs.kubernetes-workload-probe-readiness-tcp-port }}
    kubernetes-workload-probe-readiness-exec-command: ${{ inputs.kubernetes-workload-probe-readiness-exec-command }}
    kubernetes-workload-probe-readiness-grpc-port: ${{ inputs.kubernetes-workload-probe-readiness-grpc-port }}
    kubernetes-workload-probe-readiness-grpc-service: ${{ inputs.kubernetes-workload-probe-readiness-grpc-service }}
    kubernetes-workload-probe-readiness-initial-delay-seconds: ${{ inputs.kubernetes-workload-probe-readiness-initial-delay-seconds }}
    kubernetes-workload-probe-readiness-period-seconds: ${{ inputs.kubernetes-workload-probe-readiness-period-seconds }}
    kubernetes-workload-probe-readiness-timeout-seconds: ${{ inputs.kubernetes-workload-probe-readiness-timeout-seconds }}
    kubernetes-workload-probe-readiness-failure-threshold: ${{ inputs.kubernetes-workload-probe-readiness-failure-threshold }}
    kubernetes-workload-probe-readiness-success-threshold: ${{ inputs.kubernetes-workload-probe-readiness-success-threshold }}
    # Startup probe settings
    kubernetes-workload-probe-startup-check-type: ${{ inputs.kubernetes-workload-probe-startup-check-type }}
    kubernetes-workload-probe-startup-http-path: ${{ inputs.kubernetes-workload-probe-startup-http-path }}
    kubernetes-workload-probe-startup-http-scheme: ${{ inputs.kubernetes-workload-probe-startup-http-scheme }}
    kubernetes-workload-probe-startup-tcp-port: ${{ inputs.kubernetes-workload-probe-startup-tcp-port }}
    kubernetes-workload-probe-startup-exec-command: ${{ inputs.kubernetes-workload-probe-startup-exec-command }}
    kubernetes-workload-probe-startup-grpc-port: ${{ inputs.kubernetes-workload-probe-startup-grpc-port }}
    kubernetes-workload-probe-startup-grpc-service: ${{ inputs.kubernetes-workload-probe-startup-grpc-service }}
    kubernetes-workload-probe-startup-initial-delay-seconds: ${{ inputs.kubernetes-workload-probe-startup-initial-delay-seconds }}
    kubernetes-workload-probe-startup-period-seconds: ${{ inputs.kubernetes-workload-probe-startup-period-seconds }}
    kubernetes-workload-probe-startup-timeout-seconds: ${{ inputs.kubernetes-workload-probe-startup-timeout-seconds }}
    kubernetes-workload-probe-startup-failure-threshold: ${{ inputs.kubernetes-workload-probe-startup-failure-threshold }}
    kubernetes-workload-probe-startup-termination-grace-period-seconds: ${{ inputs.kubernetes-workload-probe-startup-termination-grace-period-seconds }}
    # StatefulSet-specific settings
    kubernetes-statefulset-service-name: ${{ inputs.kubernetes-statefulset-service-name }}
    kubernetes-statefulset-pod-management-policy: ${{ inputs.kubernetes-statefulset-pod-management-policy }}
    kubernetes-statefulset-update-strategy-type: ${{ inputs.kubernetes-statefulset-update-strategy-type }}
    kubernetes-statefulset-update-strategy-partition: ${{ inputs.kubernetes-statefulset-update-strategy-partition }}
    kubernetes-statefulset-pvc-enabled: ${{ inputs.kubernetes-statefulset-pvc-enabled }}
    kubernetes-statefulset-pvc-storage-class: ${{ inputs.kubernetes-statefulset-pvc-storage-class }}
    kubernetes-statefulset-pvc-storage-size: ${{ inputs.kubernetes-statefulset-pvc-storage-size }}
    kubernetes-statefulset-pvc-access-mode: ${{ inputs.kubernetes-statefulset-pvc-access-mode }}
    kubernetes-statefulset-pvc-volume-name: ${{ inputs.kubernetes-statefulset-pvc-volume-name }}
    kubernetes-statefulset-pvc-mount-path: ${{ inputs.kubernetes-statefulset-pvc-mount-path }}
    # DaemonSet-specific settings
    kubernetes-daemonset-update-strategy-type: ${{ inputs.kubernetes-daemonset-update-strategy-type }}
    kubernetes-daemonset-max-unavailable: ${{ inputs.kubernetes-daemonset-max-unavailable }}
    kubernetes-daemonset-host-network: ${{ inputs.kubernetes-daemonset-host-network }}
    kubernetes-daemonset-host-pid: ${{ inputs.kubernetes-daemonset-host-pid }}
    kubernetes-daemonset-host-ipc: ${{ inputs.kubernetes-daemonset-host-ipc }}
    kubernetes-daemonset-run-as-non-root: ${{ inputs.kubernetes-daemonset-run-as-non-root }}
    kubernetes-daemonset-privileged: ${{ inputs.kubernetes-daemonset-privileged }}
    kubernetes-daemonset-dns-policy: ${{ inputs.kubernetes-daemonset-dns-policy }}
    kubernetes-daemonset-tolerations: ${{ inputs.kubernetes-daemonset-tolerations }}
    kubernetes-daemonset-node-selector: ${{ inputs.kubernetes-daemonset-node-selector }}
    # Global settings
    output-sub-path: ${{ inputs.output-sub-path }}
    token-name-style: ${{ inputs.token-name-style }}
    token-delimiter-style: ${{ inputs.token-delimiter-style }}
    kubernetes-global-additional-labels: ${{ inputs.kubernetes-global-additional-labels }}
    kubernetes-global-additional-annotations: ${{ inputs.kubernetes-global-additional-annotations }}
